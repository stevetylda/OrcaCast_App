{"version":3,"file":"geojson-vt.mjs","sources":["../src/simplify.ts","../src/feature.ts","../src/convert.ts","../src/clip.ts","../src/wrap.ts","../src/transform.ts","../src/tile.ts","../src/difference.ts","../src/index.ts"],"sourcesContent":["/**\n * calculate simplification data using optimized Douglas-Peucker algorithm\n * @param coords - flat array of coordinates\n * @param first - index of the first coordinate in the segment\n * @param last - index of the last coordinate in the segment\n * @param sqTolerance - square tolerance value\n */\nexport function simplify(coords: number[], first: number, last: number, sqTolerance: number) {\n    let maxSqDist = sqTolerance;\n    const mid = first + ((last - first) >> 1);\n    let minPosToMid = last - first;\n    let index;\n\n    const ax = coords[first];\n    const ay = coords[first + 1];\n    const bx = coords[last];\n    const by = coords[last + 1];\n\n    for (let i = first + 3; i < last; i += 3) {\n        const d = getSqSegDist(coords[i], coords[i + 1], ax, ay, bx, by);\n\n        if (d > maxSqDist) {\n            index = i;\n            maxSqDist = d;\n            continue;\n        }\n\n        if (d === maxSqDist) {\n            // a workaround to ensure we choose a pivot close to the middle of the list,\n            // reducing recursion depth, for certain degenerate inputs\n            // https://github.com/mapbox/geojson-vt/issues/104\n            const posToMid = Math.abs(i - mid);\n            if (posToMid < minPosToMid) {\n                index = i;\n                minPosToMid = posToMid;\n            }\n        }\n    }\n\n    if (maxSqDist > sqTolerance) {\n        if (index - first > 3) simplify(coords, first, index, sqTolerance);\n        coords[index + 2] = maxSqDist;\n        if (last - index > 3) simplify(coords, index, last, sqTolerance);\n    }\n}\n\n/**\n * Claculates the square distance from a point to a segment\n * @param px - x coordinate of the point\n * @param py - y coordinate of the point\n * @param x - x coordinate of the first segment endpoint\n * @param y - y coordinate of the first segment endpoint\n * @param bx - x coordinate of the second segment endpoint\n * @param by - y coordinate of the second segment endpoint\n * @returns square distance from a point to a segment\n */\nfunction getSqSegDist(px: number, py: number, x: number, y: number, bx: number, by: number): number {\n    let dx = bx - x;\n    let dy = by - y;\n\n    if (dx !== 0 || dy !== 0) {\n        const t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = bx;\n            y = by;\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n","import type { GeoJSONVTInternalFeature, GeometryType, GeometryTypeMap } from \"./definitions\";\n\nexport type SupportedGeometries = GeoJSON.Point | GeoJSON.MultiPoint | GeoJSON.LineString | GeoJSON.MultiLineString | GeoJSON.Polygon | GeoJSON.MultiPolygon;\n\n/**\n * \n * @param id - the feature's ID\n * @param type - the feature's type\n * @param geom - the feature's geometry\n * @param tags - the feature's properties\n * @returns the created feature\n */\nexport function createFeature<T extends GeometryType>(id: number | string | undefined, type: T, geom: GeometryTypeMap[T], tags: GeoJSON.GeoJsonProperties): GeoJSONVTInternalFeature {\n    // This is mostly for TypeScript type narrowing\n    const data = { type, geom } as { [K in GeometryType]: { type: K, geom: GeometryTypeMap[K] } }[GeometryType];\n\n    const feature = {\n        id: id == null ? null : id,\n        type: data.type,\n        geometry: data.geom,\n        tags,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    } as GeoJSONVTInternalFeature;\n\n    switch (data.type) {\n        case 'Point':\n        case 'MultiPoint':\n        case 'LineString':\n            calcLineBBox(feature, data.geom);\n            break;\n\n        case 'Polygon':\n            // the outer ring (ie [0]) contains all inner rings\n            calcLineBBox(feature, data.geom[0]);\n            break;\n\n        case 'MultiLineString':\n            for (const line of data.geom) {\n                calcLineBBox(feature, line);\n            }\n            break;\n\n        case 'MultiPolygon':\n            for (const polygon of data.geom) {\n                // the outer ring (ie [0]) contains all inner rings\n                calcLineBBox(feature, polygon[0]);\n            }\n            break;\n    }\n\n    return feature;\n}\n\nfunction calcLineBBox(feature: GeoJSONVTInternalFeature, geom: number[]) {\n    for (let i = 0; i < geom.length; i += 3) {\n        feature.minX = Math.min(feature.minX, geom[i]);\n        feature.minY = Math.min(feature.minY, geom[i + 1]);\n        feature.maxX = Math.max(feature.maxX, geom[i]);\n        feature.maxY = Math.max(feature.maxY, geom[i + 1]);\n    }\n}\n","\nimport {simplify} from './simplify';\nimport {createFeature} from './feature';\nimport type { GeoJSONVTInternalFeature, GeoJSONVTOptions, StartEndSizeArray } from './definitions';\n\n/**\n * converts GeoJSON feature into an intermediate projected JSON vector format with simplification data\n * @param data\n * @param options\n * @returns\n */\nexport function convert(data: GeoJSON.GeoJSON, options: GeoJSONVTOptions): GeoJSONVTInternalFeature[] {\n    const features: GeoJSONVTInternalFeature[] = [];\n\n    switch (data.type) {\n        case 'FeatureCollection':\n            for (let i = 0; i < data.features.length; i++) {\n                convertFeature(features, data.features[i], options, i);\n            }\n            break;\n        case 'Feature':\n            convertFeature(features, data, options);\n            break;\n        default:\n            convertFeature(features, {type: \"Feature\" as const, geometry: data, properties: undefined}, options);\n    }\n\n    return features;\n}\n\nfunction convertFeature(features: GeoJSONVTInternalFeature[], geojson: GeoJSON.Feature, options: GeoJSONVTOptions, index?: number) {\n    if (!geojson.geometry) return;\n\n    if (geojson.geometry.type === 'GeometryCollection') {\n        for (const singleGeometry of geojson.geometry.geometries) {\n            convertFeature(features, {\n                id: geojson.id,\n                type: 'Feature',\n                geometry: singleGeometry,\n                properties: geojson.properties\n            }, options, index);\n        }\n        return;\n    }\n\n    const coords = geojson.geometry.coordinates;\n    if (!coords?.length) return;\n\n    const tolerance = Math.pow(options.tolerance / ((1 << options.maxZoom) * options.extent), 2);\n    let id = geojson.id;\n    if (options.promoteId) {\n        id = geojson.properties?.[options.promoteId];\n    } else if (options.generateId) {\n        id = index || 0;\n    }\n\n    switch (geojson.geometry.type) {\n        case 'Point': {\n            const pointGeometry: StartEndSizeArray = [];\n            convertPoint(geojson.geometry.coordinates, pointGeometry);\n\n            features.push(createFeature(id, geojson.geometry.type, pointGeometry, geojson.properties));\n            return;\n        }\n\n        case 'MultiPoint': {\n            const multiPointGeometry: StartEndSizeArray = [];\n            for (const p of geojson.geometry.coordinates) {\n                convertPoint(p, multiPointGeometry);\n            }\n\n            features.push(createFeature(id, geojson.geometry.type, multiPointGeometry, geojson.properties));\n            return;\n        }\n\n        case 'LineString': {\n            const lineGeometry: StartEndSizeArray = [];\n            convertLine(geojson.geometry.coordinates, lineGeometry, tolerance, false);\n\n            features.push(createFeature(id, geojson.geometry.type, lineGeometry, geojson.properties));\n            return;\n        }\n\n        case 'MultiLineString': {\n            if (options.lineMetrics) {\n                // explode into linestrings in order to track metrics\n                for (const line of geojson.geometry.coordinates) {\n                    const lineGeometry: StartEndSizeArray = [];\n                    convertLine(line, lineGeometry, tolerance, false);\n                    features.push(createFeature(id, 'LineString', lineGeometry, geojson.properties));\n                }\n                return;\n            }\n\n            const multiLineGeometry: StartEndSizeArray[] = [];\n            convertLines(geojson.geometry.coordinates, multiLineGeometry, tolerance, false);\n\n            features.push(createFeature(id, geojson.geometry.type, multiLineGeometry, geojson.properties));\n            return;\n        }\n\n        case 'Polygon': {\n            const polygonGeometry: StartEndSizeArray[] = [];\n            convertLines(geojson.geometry.coordinates, polygonGeometry, tolerance, true);\n\n            features.push(createFeature(id, geojson.geometry.type, polygonGeometry, geojson.properties));\n            return;\n        }\n\n        case 'MultiPolygon': {\n            const multiPolygonGeometry: StartEndSizeArray[][] = [];\n            for (const polygon of geojson.geometry.coordinates) {\n                const newPolygon: StartEndSizeArray[] = [];\n                convertLines(polygon, newPolygon, tolerance, true);\n                multiPolygonGeometry.push(newPolygon);\n            }\n\n            features.push(createFeature(id, geojson.geometry.type, multiPolygonGeometry, geojson.properties));\n            return;\n        }\n\n        default:\n            throw new Error('Input data is not a valid GeoJSON object.');\n    }\n}\n\nfunction convertPoint(coords: GeoJSON.Position, out: number[]) {\n    out.push(projectX(coords[0]), projectY(coords[1]), 0);\n}\n\nfunction convertLine(ring: GeoJSON.Position[], out: StartEndSizeArray, tolerance: number, isPolygon: boolean) {\n    let x0, y0;\n    let size = 0;\n\n    for (let j = 0; j < ring.length; j++) {\n        const x = projectX(ring[j][0]);\n        const y = projectY(ring[j][1]);\n\n        out.push(x, y, 0);\n\n        if (j > 0) {\n            if (isPolygon) {\n                size += (x0 * y - x * y0) / 2; // area\n            } else {\n                size += Math.sqrt(Math.pow(x - x0, 2) + Math.pow(y - y0, 2)); // length\n            }\n        }\n        x0 = x;\n        y0 = y;\n    }\n\n    const last = out.length - 3;\n    out[2] = 1;\n    if (tolerance > 0) simplify(out, 0, last, tolerance);\n    out[last + 2] = 1;\n\n    out.size = Math.abs(size);\n    out.start = 0;\n    out.end = out.size;\n}\n\nfunction convertLines(rings: GeoJSON.Position[][], out: StartEndSizeArray[], tolerance: number, isPolygon: boolean) {\n    for (let i = 0; i < rings.length; i++) {\n        const geom: StartEndSizeArray = [];\n        convertLine(rings[i], geom, tolerance, isPolygon);\n        out.push(geom);\n    }\n}\n\nfunction projectX(x: number) {\n    return x / 360 + 0.5;\n}\n\nfunction projectY(y: number) {\n    const sin = Math.sin(y * Math.PI / 180);\n    const y2 = 0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI;\n    return y2 < 0 ? 0 : y2 > 1 ? 1 : y2;\n}\n","\nimport {createFeature} from './feature';\nimport type { GeoJSONVTInternalFeature, GeoJSONVTOptions, StartEndSizeArray } from './definitions';\n\n/* clip features between two vertical or horizontal axis-parallel lines:\n *     |        |\n *  ___|___     |     /\n * /   |   \\____|____/\n *     |        |\n *\n * k1 and k2 are the line coordinates\n * axis: 0 for x, 1 for y\n * minAll and maxAll: minimum and maximum coordinate value for all features\n */\nexport function clip(features: GeoJSONVTInternalFeature[], scale: number, k1: number, k2: number, axis: number, minAll: number, maxAll: number, options: GeoJSONVTOptions): GeoJSONVTInternalFeature[] | null {\n    k1 /= scale;\n    k2 /= scale;\n\n    if (minAll >= k1 && maxAll < k2) { // trivial accept\n        return features;\n    }\n\n    if (maxAll < k1 || minAll >= k2) { // trivial reject\n        return null;\n    }\n\n    const clipped: GeoJSONVTInternalFeature[] = [];\n\n    for (const feature of features) {\n        const min = axis === 0 ? feature.minX : feature.minY;\n        const max = axis === 0 ? feature.maxX : feature.maxY;\n\n        if (min >= k1 && max < k2) { // trivial accept\n            clipped.push(feature);\n            continue;\n        }\n\n        if (max < k1 || min >= k2) { // trivial reject\n            continue;\n        }\n\n        switch (feature.type) {\n            case 'Point':\n            case 'MultiPoint': {\n                const pointGeometry: number[] = [];\n                clipPoints(feature.geometry, pointGeometry, k1, k2, axis);\n                if (!pointGeometry.length) continue;\n\n                const type = pointGeometry.length === 3 ? 'Point' : 'MultiPoint';\n                clipped.push(createFeature(feature.id, type, pointGeometry, feature.tags));\n                continue;\n            }\n\n            case 'LineString': {\n                const lineGeometry: StartEndSizeArray[] = [];\n                clipLine(feature.geometry, lineGeometry, k1, k2, axis, false, options.lineMetrics);\n                if (!lineGeometry.length) continue;\n\n                if (options.lineMetrics) {\n                    for (const line of lineGeometry) {\n                        clipped.push(createFeature(feature.id, feature.type, line, feature.tags));\n                    }\n                    continue;\n                }\n\n                if (lineGeometry.length > 1) {\n                    clipped.push(createFeature(feature.id, \"MultiLineString\", lineGeometry, feature.tags));\n                    continue;\n                }\n\n                clipped.push(createFeature(feature.id, feature.type, lineGeometry[0], feature.tags));\n                continue;\n            }\n\n            case 'MultiLineString': {\n                const multiLineGeometry: StartEndSizeArray[] = [];\n                clipLines(feature.geometry, multiLineGeometry, k1, k2, axis, false);\n                if (!multiLineGeometry.length) continue;\n\n                if (multiLineGeometry.length === 1) {\n                    clipped.push(createFeature(feature.id, \"LineString\", multiLineGeometry[0], feature.tags));\n                    continue;\n                }\n\n                clipped.push(createFeature(feature.id, feature.type, multiLineGeometry, feature.tags));\n                continue;\n            }\n\n            case 'Polygon': {\n                const polygonGeometry: StartEndSizeArray[] = [];\n                clipLines(feature.geometry, polygonGeometry, k1, k2, axis, true);\n                if (!polygonGeometry.length) continue;\n\n                clipped.push(createFeature(feature.id, feature.type, polygonGeometry, feature.tags));\n                continue;\n            }\n\n            case 'MultiPolygon': {\n                const multiPolygonGeometry: StartEndSizeArray[][] = [];\n                for (const polygon of feature.geometry) {\n                    const newPolygon: StartEndSizeArray[] = [];\n                    clipLines(polygon, newPolygon, k1, k2, axis, true);\n                    if (newPolygon.length) multiPolygonGeometry.push(newPolygon);\n                }\n                if (!multiPolygonGeometry.length) continue;\n\n                clipped.push(createFeature(feature.id, feature.type, multiPolygonGeometry, feature.tags));\n                continue;\n            }\n        }\n    }\n\n    if (!clipped.length) return null;\n\n    return clipped;\n}\n\nfunction clipPoints(geom: number[], newGeom: number[], k1: number, k2: number, axis: number) {\n    for (let i = 0; i < geom.length; i += 3) {\n        const a = geom[i + axis];\n\n        if (a >= k1 && a <= k2) {\n            addPoint(newGeom, geom[i], geom[i + 1], geom[i + 2]);\n        }\n    }\n}\n\nfunction clipLine(geom: StartEndSizeArray, newGeom: StartEndSizeArray[], k1: number, k2: number, axis: number, isPolygon: boolean, trackMetrics: boolean) {\n\n    let slice = newSlice(geom);\n    const intersect = axis === 0 ? intersectX : intersectY;\n    let len = geom.start;\n    let segLen, t;\n\n    for (let i = 0; i < geom.length - 3; i += 3) {\n        const ax = geom[i];\n        const ay = geom[i + 1];\n        const az = geom[i + 2];\n        const bx = geom[i + 3];\n        const by = geom[i + 4];\n        const a = axis === 0 ? ax : ay;\n        const b = axis === 0 ? bx : by;\n        let exited = false;\n\n        if (trackMetrics) segLen = Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n\n        if (a < k1) {\n            // ---|-->  | (line enters the clip region from the left)\n            if (b > k1) {\n                t = intersect(slice, ax, ay, bx, by, k1);\n                if (trackMetrics) slice.start = len + segLen * t;\n            }\n        } else if (a > k2) {\n            // |  <--|--- (line enters the clip region from the right)\n            if (b < k2) {\n                t = intersect(slice, ax, ay, bx, by, k2);\n                if (trackMetrics) slice.start = len + segLen * t;\n            }\n        } else {\n            addPoint(slice, ax, ay, az);\n        }\n\n        if (b < k1 && a >= k1) {\n            // <--|---  | or <--|-----|--- (line exits the clip region on the left)\n            t = intersect(slice, ax, ay, bx, by, k1);\n            exited = true;\n        }\n\n        if (b > k2 && a <= k2) {\n            // |  ---|--> or ---|-----|--> (line exits the clip region on the right)\n            t = intersect(slice, ax, ay, bx, by, k2);\n            exited = true;\n        }\n\n        if (!isPolygon && exited) {\n            if (trackMetrics) slice.end = len + segLen * t;\n            newGeom.push(slice);\n            slice = newSlice(geom);\n        }\n\n        if (trackMetrics) len += segLen;\n    }\n\n    // add the last point\n    let last = geom.length - 3;\n    const ax = geom[last];\n    const ay = geom[last + 1];\n    const az = geom[last + 2];\n    const a = axis === 0 ? ax : ay;\n    if (a >= k1 && a <= k2) addPoint(slice, ax, ay, az);\n\n    // close the polygon if its endpoints are not the same after clipping\n    last = slice.length - 3;\n    if (isPolygon && last >= 3 && (slice[last] !== slice[0] || slice[last + 1] !== slice[1])) {\n        addPoint(slice, slice[0], slice[1], slice[2]);\n    }\n\n    // add the final slice\n    if (slice.length) {\n        newGeom.push(slice);\n    }\n}\n\nfunction newSlice(line: StartEndSizeArray): StartEndSizeArray {\n    const slice: StartEndSizeArray = [];\n    slice.size = line.size;\n    slice.start = line.start;\n    slice.end = line.end;\n    return slice;\n}\n\nfunction clipLines(geom: StartEndSizeArray[], newGeom: StartEndSizeArray[], k1: number, k2: number, axis: number, isPolygon: boolean) {\n    for (const line of geom) {\n        clipLine(line, newGeom, k1, k2, axis, isPolygon, false);\n    }\n}\n\nfunction addPoint(out: number[], x: number, y: number, z: number) {\n    out.push(x, y, z);\n}\n\nfunction intersectX(out: StartEndSizeArray, ax: number, ay: number, bx: number, by: number, x: number) {\n    const t = (x - ax) / (bx - ax);\n    addPoint(out, x, ay + (by - ay) * t, 1);\n    return t;\n}\n\nfunction intersectY(out: StartEndSizeArray, ax: number, ay: number, bx: number, by: number, y: number) {\n    const t = (y - ay) / (by - ay);\n    addPoint(out, ax + (bx - ax) * t, y, 1);\n    return t;\n}\n","\nimport {clip} from './clip';\nimport type { GeoJSONVTInternalFeature, GeoJSONVTOptions, StartEndSizeArray } from './definitions';\nimport {createFeature} from './feature';\n\nexport function wrap(features: GeoJSONVTInternalFeature[], options: GeoJSONVTOptions): GeoJSONVTInternalFeature[] {\n    const buffer = options.buffer / options.extent;\n    let merged = features;\n\n    const left  = clip(features, 1, -1 - buffer, buffer,     0, -1, 2, options); // left world copy\n    const right = clip(features, 1,  1 - buffer, 2 + buffer, 0, -1, 2, options); // right world copy\n\n    if (!left && !right) return merged;\n\n    merged = clip(features, 1, -buffer, 1 + buffer, 0, -1, 2, options) || []; // center world copy\n\n    if (left) merged = shiftFeatureCoords(left, 1).concat(merged); // merge left into center\n    if (right) merged = merged.concat(shiftFeatureCoords(right, -1)); // merge right into center\n\n    return merged;\n}\n\nfunction shiftFeatureCoords(features: GeoJSONVTInternalFeature[], offset: number): GeoJSONVTInternalFeature[] {\n    const newFeatures = [];\n\n    for (const feature of features) {\n        switch (feature.type) {\n            case 'Point':\n            case 'MultiPoint':\n            case 'LineString': {\n                const newGeometry = shiftCoords(feature.geometry, offset);\n\n                newFeatures.push(createFeature(feature.id, feature.type, newGeometry, feature.tags));\n                continue;\n            }\n\n            case 'MultiLineString':\n            case 'Polygon': {\n                const newGeometry = [];\n                for (const line of feature.geometry) {\n                    newGeometry.push(shiftCoords(line, offset));\n                }\n\n                newFeatures.push(createFeature(feature.id, feature.type, newGeometry, feature.tags));\n                continue;\n            }\n\n            case 'MultiPolygon': {\n                const newGeometry = [];\n                for (const polygon of feature.geometry) {\n                    const newPolygon = [];\n                    for (const line of polygon) {\n                        newPolygon.push(shiftCoords(line, offset));\n                    }\n                    newGeometry.push(newPolygon);\n                }\n\n                newFeatures.push(createFeature(feature.id, feature.type, newGeometry, feature.tags));\n                continue;\n            }\n        }\n    }\n\n    return newFeatures;\n}\n\nfunction shiftCoords(points: StartEndSizeArray, offset: number): number[] | StartEndSizeArray {\n    const newPoints: StartEndSizeArray = [];\n    newPoints.size = points.size;\n\n    if (points.start !== undefined) {\n        newPoints.start = points.start;\n        newPoints.end = points.end;\n    }\n\n    for (let i = 0; i < points.length; i += 3) {\n        newPoints.push(points[i] + offset, points[i + 1], points[i + 2]);\n    }\n\n    return newPoints;\n}\n","import type { GeoJSONVTInternalTile } from \"./tile\";\n\nexport type GeoJSONVTFeaturePoint = {\n    id? : number | string | undefined;\n    type: 1;\n    tags: GeoJSON.GeoJsonProperties | null;\n    geometry: [number, number][]\n}\n\nexport type GeoJSONVTFeatureNonPoint = {\n    id? : number | string | undefined;\n    type: 2 | 3;\n    tags: GeoJSON.GeoJsonProperties | null;\n    geometry: [number, number][][]\n}\n\nexport type GeoJSONVTFeature = GeoJSONVTFeaturePoint | GeoJSONVTFeatureNonPoint;\n\nexport type GeoJSONVTTile = GeoJSONVTInternalTile & {\n    transformed: true;\n    features: GeoJSONVTFeature[]\n}\n\n/**\n * Transforms the coordinates of each feature in the given tile from\n * mercator-projected space into (extent x extent) tile space.\n * @param tile - the tile to transform, this gets modified in place\n * @param extent - the tile extent (usually 4096)\n * @returns the transformed tile\n */\nexport function transformTile(tile: GeoJSONVTInternalTile, extent: number): GeoJSONVTTile {\n    if (tile.transformed) {\n        return tile as GeoJSONVTTile;\n    }\n\n    const z2 = 1 << tile.z;\n    const tx = tile.x;\n    const ty = tile.y;\n\n    for (const feature of tile.features) {\n        if (feature.type === 1) {\n            const pointGeometry: [number, number][] = []\n            for (let j = 0; j < feature.geometry.length; j += 2) {\n                pointGeometry.push(transformPoint(feature.geometry[j], feature.geometry[j + 1], extent, z2, tx, ty));\n            }\n            (feature as unknown as GeoJSONVTFeaturePoint).geometry = pointGeometry;\n            continue;\n        }\n\n        const geometry: [number, number][][] = [];\n        for (const singleGeom of feature.geometry) {\n            const ring: [number, number][] = [];\n            for (let k = 0; k < singleGeom.length; k += 2) {\n                ring.push(transformPoint(singleGeom[k], singleGeom[k + 1], extent, z2, tx, ty));\n            }\n            geometry.push(ring);\n        }\n        (feature as unknown as GeoJSONVTFeatureNonPoint).geometry = geometry;\n    }\n    tile.transformed = true;\n\n    return tile as GeoJSONVTTile;\n}\n\nfunction transformPoint(x: number, y: number, extent: number, z2: number, tx: number, ty: number): [number, number] {\n    return [\n        Math.round(extent * (x * z2 - tx)),\n        Math.round(extent * (y * z2 - ty))\n    ];\n}\n","import type { GeoJSONVTInternalFeature, GeoJSONVTOptions, StartEndSizeArray } from \"./definitions\";\n\nexport type GeoJSONVTInternalTileFeaturePoint = {\n    id? : number | string | undefined;\n    type: 1;\n    tags: GeoJSON.GeoJsonProperties | null;\n    geometry: number[];\n}\n\nexport type GeoJSONVTInternalTileFeaturNonPoint = {\n    id? : number | string | undefined;\n    type: 2 | 3;\n    tags: GeoJSON.GeoJsonProperties | null;\n    geometry: number[][];\n}\nexport type GeoJSONVTInternalTileFeature = GeoJSONVTInternalTileFeaturePoint | GeoJSONVTInternalTileFeaturNonPoint;\n\nexport type GeoJSONVTInternalTile = {\n    features: GeoJSONVTInternalTileFeature[];\n    numPoints: number;\n    numSimplified: number;\n    numFeatures: number;\n    x: number;\n    y: number;\n    z: number;\n    transformed: boolean;\n    minX: number;\n    minY: number;\n    maxX: number;\n    maxY: number;\n    source: GeoJSONVTInternalFeature[] | null;\n}\n\n/**\n * Creates a tile object from the given features\n * @param features - the features to include in the tile\n * @param z\n * @param tx\n * @param ty\n * @param options - the options object\n * @returns the created tile\n */\nexport function createTile(features: GeoJSONVTInternalFeature[], z: number, tx: number, ty: number, options: GeoJSONVTOptions): GeoJSONVTInternalTile {\n    const tolerance = z === options.maxZoom ? 0 : options.tolerance / ((1 << z) * options.extent);\n\n    const tile = {\n        features: [] as GeoJSONVTInternalTileFeature[],\n        numPoints: 0,\n        numSimplified: 0,\n        numFeatures: features.length,\n        source: null as GeoJSONVTInternalFeature[] | null,\n        x: tx,\n        y: ty,\n        z,\n        transformed: false,\n        minX: 2,\n        minY: 1,\n        maxX: -1,\n        maxY: 0\n    };\n\n    for (const feature of features) {\n        addFeature(tile, feature, tolerance, options);\n    }\n\n    return tile;\n}\n\nfunction addFeature(tile: GeoJSONVTInternalTile, feature: GeoJSONVTInternalFeature, tolerance: number, options: GeoJSONVTOptions) {\n    tile.minX = Math.min(tile.minX, feature.minX);\n    tile.minY = Math.min(tile.minY, feature.minY);\n    tile.maxX = Math.max(tile.maxX, feature.maxX);\n    tile.maxY = Math.max(tile.maxY, feature.maxY);\n\n    let tags = feature.tags || null;\n\n    let tileFeature: GeoJSONVTInternalTileFeature;\n\n    switch (feature.type) {\n        case 'Point':\n        case 'MultiPoint': {\n            const geometry: number[] = [];\n            for (let i = 0; i < feature.geometry.length; i += 3) {\n                geometry.push(feature.geometry[i] , feature.geometry[i + 1]);\n                tile.numPoints++;\n                tile.numSimplified++;\n            }\n            if (!geometry.length) return;\n            tileFeature = {\n                type: 1,\n                tags: tags,\n                geometry: geometry\n            }\n            break;\n        }\n        case 'LineString': {\n            const geometry: number[][] = [];\n            addLine(geometry, feature.geometry, tile, tolerance, false, false);\n            if (!geometry.length) return;\n            if (options.lineMetrics) {\n                tags = {};\n                for (const key in feature.tags) tags[key] = feature.tags[key];\n                // HM TODO: replace with geojsonvt\n                tags['mapbox_clip_start'] = feature.geometry.start / feature.geometry.size;\n                tags['mapbox_clip_end'] = feature.geometry.end / feature.geometry.size;\n            }\n            tileFeature = {\n                type: 2,\n                tags: tags,\n                geometry: geometry\n            }\n            break;\n        }\n        case 'MultiLineString':\n        case 'Polygon': {\n            const geometry: number[][] = [];\n            for (let i = 0; i < feature.geometry.length; i++) {\n                addLine(geometry, feature.geometry[i], tile, tolerance, feature.type === 'Polygon', i === 0);\n            }\n            if (!geometry.length) return;\n            tileFeature = {\n                type: feature.type === 'Polygon' ? 3 : 2,\n                tags: tags,\n                geometry: geometry\n            }\n            break;\n        }\n        case 'MultiPolygon': {\n            const geometry: number[][] = [];\n            for (let k = 0; k < feature.geometry.length; k++) {\n                const polygon = feature.geometry[k];\n                for (let i = 0; i < polygon.length; i++) {\n                    addLine(geometry, polygon[i], tile, tolerance, true, i === 0);\n                }\n            }\n            if (!geometry.length) return;\n            tileFeature = {\n                type: 3,\n                tags: tags,\n                geometry: geometry\n            }\n            break;\n        }\n    }\n\n    if (feature.id !== null) {\n        tileFeature.id = feature.id;\n    }\n\n    tile.features.push(tileFeature);\n}\n\nfunction addLine(result: number[][], geom: StartEndSizeArray, tile: GeoJSONVTInternalTile, tolerance: number, isPolygon: boolean, isOuter: boolean) {\n    const sqTolerance = tolerance * tolerance;\n\n    if (tolerance > 0 && (geom.size < (isPolygon ? sqTolerance : tolerance))) {\n        tile.numPoints += geom.length / 3;\n        return;\n    }\n\n    const ring = [];\n\n    for (let i = 0; i < geom.length; i += 3) {\n        if (tolerance === 0 || geom[i + 2] > sqTolerance) {\n            tile.numSimplified++;\n            ring.push(geom[i], geom[i + 1]);\n        }\n        tile.numPoints++;\n    }\n\n    if (isPolygon) rewind(ring, isOuter);\n\n    result.push(ring);\n}\n\nfunction rewind(ring: number[], clockwise: boolean) {\n    let area = 0;\n\n    for (let i = 0, len = ring.length, j = len - 2; i < len; j = i, i += 2) {\n        area += (ring[i] - ring[j]) * (ring[i + 1] + ring[j + 1]);\n    }\n\n    if (area > 0 !== clockwise) return;\n\n    for (let i = 0, len = ring.length; i < len / 2; i += 2) {\n        const x = ring[i];\n        const y = ring[i + 1];\n\n        ring[i] = ring[len - 2 - i];\n        ring[i + 1] = ring[len - 1 - i];\n        ring[len - 2 - i] = x;\n        ring[len - 1 - i] = y;\n    }\n}\n","import {convert} from './convert';\nimport {wrap} from './wrap';\nimport type { GeoJSONVTInternalFeature, GeoJSONVTOptions } from './definitions';\n\nexport type GeoJSONVTSourceDiff = {\n    /**\n     * If true, clear all existing features\n     */\n    removeAll?: boolean;\n    /**\n     * Array of feature IDs to remove\n     */\n    remove?: (string | number)[];\n    /**\n     * Array of GeoJSON features to add\n     */\n    add?: GeoJSON.Feature[];\n    /**\n     * Array of per-feature updates\n     */\n    update?: GeoJSONVTFeatureDiff[];\n};\n\nexport type GeoJSONVTFeatureDiff = {\n    /**\n     * ID of the feature being updated\n     */\n    id: string | number;\n    /**\n     * Optional new geometry\n     */\n    newGeometry?: GeoJSON.Geometry;\n    /**\n     * Remove all properties if true\n     */\n    removeAllProperties?: boolean;\n    /**\n     * Specific properties to delete\n     */\n    removeProperties?: string[];\n    /**\n     * Properties to add or update\n     */\n    addOrUpdateProperties?: {\n        key: string;\n        value: unknown;\n    }[];\n};\n\ntype HashedGeoJSONVTSourceDiff = {\n    removeAll?: boolean | undefined;\n    remove: Set<string | number>;\n    add: Map<string | number | undefined, GeoJSON.Feature>;\n    update: Map<string | number, GeoJSONVTFeatureDiff>;\n};\n\n/**\n * Applies a GeoJSON Source Diff to an existing set of simplified features\n * @param source \n * @param dataDiff \n * @param options \n * @returns \n */\nexport function applySourceDiff(source: GeoJSONVTInternalFeature[], dataDiff: GeoJSONVTSourceDiff, options: GeoJSONVTOptions) {\n\n    // convert diff to sets/maps for o(1) lookups\n    const diff = diffToHashed(dataDiff);\n\n    // collection for features that will be affected by this update\n    let affected: GeoJSONVTInternalFeature[] = [];\n\n    // full removal - clear everything before applying diff\n    if (diff.removeAll) {\n        affected = source;\n        source = [];\n    }\n\n    // remove/add features and collect affected ones\n    if (diff.remove.size || diff.add.size) {\n        const removeFeatures = [];\n\n        // collect source features to be removed\n        for (const feature of source) {\n            const {id} = feature;\n\n            // explicit feature removal\n            if (diff.remove.has(id)) {\n                removeFeatures.push(feature);\n            // feature with duplicate id being added\n            } else if (diff.add.has(id)) {\n                removeFeatures.push(feature);\n            }\n        }\n\n        // collect affected and remove from source\n        if (removeFeatures.length) {\n            affected.push(...removeFeatures);\n\n            const removeIds = new Set(removeFeatures.map(f => f.id));\n            source = source.filter(f => !removeIds.has(f.id));\n        }\n\n        // convert and add new features\n        if (diff.add.size) {\n            // projects and adds simplification info\n            let addFeatures = convert({type: 'FeatureCollection', features: Array.from(diff.add.values())}, options);\n\n            // wraps features (ie extreme west and extreme east)\n            addFeatures = wrap(addFeatures, options);\n\n            affected.push(...addFeatures);\n            source.push(...addFeatures);\n        }\n    }\n\n    if (diff.update.size) {\n        for (const [id, update] of diff.update) {\n            const featureIndex = source.findIndex(f => f.id === id);\n            if (featureIndex === -1) continue;\n\n            const feature = source[featureIndex];\n\n            // get updated geojsonvt simplified feature\n            const updatedFeature = getUpdatedFeature(feature, update, options);\n            if (!updatedFeature) continue;\n\n            // track both features for invalidation\n            affected.push(feature, updatedFeature);\n\n            // replace old feature with updated feature\n            source[featureIndex] = updatedFeature;\n        }\n    }\n\n    return {affected, source};\n}\n\n// return an updated geojsonvt simplified feature\nfunction getUpdatedFeature(vtFeature: GeoJSONVTInternalFeature, update: GeoJSONVTFeatureDiff, options: GeoJSONVTOptions): GeoJSONVTInternalFeature | null {\n    const changeGeometry = !!update.newGeometry;\n\n    const changeProps =\n        update.removeAllProperties ||\n        update.removeProperties?.length > 0 ||\n        update.addOrUpdateProperties?.length > 0;\n\n    // if geometry changed, need to create new geojson feature and convert to simplified format\n    if (changeGeometry) {\n        const geojsonFeature = {\n            type: 'Feature' as const,\n            id: vtFeature.id,\n            geometry: update.newGeometry,\n            properties: changeProps ? applyPropertyUpdates(vtFeature.tags, update) : vtFeature.tags\n        };\n\n        // projects and adds simplification info\n        let features = convert({type: 'FeatureCollection', features: [geojsonFeature]}, options);\n\n        // wraps features (ie extreme west and extreme east)\n        features = wrap(features, options);\n\n        return features[0];\n    }\n\n    // only properties changed - update tags directly\n    if (changeProps) {\n        const feature = {...vtFeature};\n        feature.tags = applyPropertyUpdates(feature.tags, update);\n        return feature;\n    }\n\n    return null;\n}\n\n/**\n * helper to apply property updates from a diff update object to a properties object\n */\nfunction applyPropertyUpdates(tags: GeoJSON.GeoJsonProperties, update: GeoJSONVTFeatureDiff): GeoJSON.GeoJsonProperties {\n    if (update.removeAllProperties) {\n        return {};\n    }\n\n    const properties = {...tags || {}};\n\n    if (update.removeProperties) {\n        for (const key of update.removeProperties) {\n            delete properties[key];\n        }\n    }\n\n    if (update.addOrUpdateProperties) {\n        for (const {key, value} of update.addOrUpdateProperties) {\n            properties[key] = value;\n        }\n    }\n\n    return properties;\n}\n\n/**\n * Convert a GeoJSON Source Diff to an idempotent hashed representation using Sets and Maps\n */\nexport function diffToHashed(diff: GeoJSONVTSourceDiff): HashedGeoJSONVTSourceDiff {\n    if (!diff) return {\n        remove: new Set(),\n        add: new Map(),\n        update: new Map()\n    };\n\n    const hashed: HashedGeoJSONVTSourceDiff = {\n        removeAll: diff.removeAll,\n        remove: new Set(diff.remove || []),\n        add: new Map(diff.add?.map(feature => [feature.id, feature])),\n        update: new Map(diff.update?.map(update => [update.id, update]))\n    };\n\n    return hashed;\n}\n","\nimport {convert} from './convert';\nimport {clip} from './clip';\nimport {wrap} from './wrap';\nimport {transformTile, type GeoJSONVTFeature, type GeoJSONVTFeatureNonPoint, type GeoJSONVTFeaturePoint, type GeoJSONVTTile} from './transform';\nimport {createTile, type GeoJSONVTInternalTile, type GeoJSONVTInternalTileFeature, type GeoJSONVTInternalTileFeaturePoint, type GeoJSONVTInternalTileFeaturNonPoint} from './tile';\nimport {applySourceDiff, type GeoJSONVTFeatureDiff, type GeoJSONVTSourceDiff} from './difference';\nimport type { GeoJSONVTInternalFeature, GeoJSONVTOptions, GeometryType, GeometryTypeMap, PartialGeoJSONVTFeature, StartEndSizeArray } from './definitions';\n\nconst defaultOptions: GeoJSONVTOptions = {\n    maxZoom: 14,\n    indexMaxZoom: 5,\n    indexMaxPoints: 100000,\n    tolerance: 3,\n    extent: 4096,\n    buffer: 64,\n    lineMetrics: false,\n    promoteId: null,\n    generateId: false,\n    updateable: false,\n    debug: 0\n};\n\n/**\n * Main class for creating and managing a vector tile index from GeoJSON data.\n */\nclass GeoJSONVT {\n    private options: GeoJSONVTOptions;\n    /** @internal */\n    public tiles: {[key: string]: GeoJSONVTInternalTile};\n    private tileCoords: {z: number, x: number, y: number, id: number}[];\n    /** @internal */\n    public stats: {[key: string]: number} = {};\n    /** @internal */\n    public total: number = 0;\n    private source?: GeoJSONVTInternalFeature[];\n\n    constructor(data: GeoJSON.GeoJSON, options: GeoJSONVTOptions) {\n        options = this.options = Object.assign({}, defaultOptions, options);\n\n        const debug = options.debug;\n\n        if (debug) console.time('preprocess data');\n\n        if (options.maxZoom < 0 || options.maxZoom > 24) throw new Error('maxZoom should be in the 0-24 range');\n        if (options.promoteId && options.generateId) throw new Error('promoteId and generateId cannot be used together.');\n\n        // projects and adds simplification info\n        let features = convert(data, options);\n\n        // tiles and tileCoords are part of the public API\n        this.tiles = {};\n        this.tileCoords = [];\n\n        if (debug) {\n            console.timeEnd('preprocess data');\n            console.log('index: maxZoom: %d, maxPoints: %d', options.indexMaxZoom, options.indexMaxPoints);\n            console.time('generate tiles');\n            this.stats = {};\n            this.total = 0;\n        }\n\n        // wraps features (ie extreme west and extreme east)\n        features = wrap(features, options);\n\n        // start slicing from the top tile down\n        if (features.length) {\n            this.splitTile(features, 0, 0, 0);\n        }\n\n        // for updateable indexes, store a copy of the original simplified features\n        if (options.updateable) {\n            this.source = features;\n        }\n\n        if (debug) {\n            if (features.length) console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n            console.timeEnd('generate tiles');\n            console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n        }\n    }\n\n    /**\n     * splits features from a parent tile to sub-tiles.\n     * z, x, and y are the coordinates of the parent tile\n     * cz, cx, and cy are the coordinates of the target tile\n     * \n     * If no target tile is specified, splitting stops when we reach the maximum\n     * zoom or the number of points is low as specified in the options.\n     * @internal\n     * @param features - features to split\n     * @param z - tile zoom level\n     * @param x - tile x coordinate\n     * @param y - tile y coordinate\n     * @param cz - target tile zoom level\n     * @param cx - target tile x coordinate\n     * @param cy - target tile y coordinate\n     */\n    splitTile(features: GeoJSONVTInternalFeature[], z: number, x: number, y: number, cz?: number, cx?: number, cy?: number) {\n\n        const stack = [features, z, x, y];\n        const options = this.options;\n        const debug = options.debug;\n\n        // avoid recursion by using a processing queue\n        while (stack.length) {\n            y = stack.pop() as number;\n            x = stack.pop() as number;\n            z = stack.pop() as number;\n            features = stack.pop() as GeoJSONVTInternalFeature[];\n\n            const z2 = 1 << z;\n            const id = toID(z, x, y);\n            let tile = this.tiles[id];\n\n            if (!tile) {\n                if (debug > 1) console.time('creation');\n\n                tile = this.tiles[id] = createTile(features, z, x, y, options);\n                this.tileCoords.push({z, x, y, id});\n\n                if (debug) {\n                    if (debug > 1) {\n                        console.log('tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n                            z, x, y, tile.numFeatures, tile.numPoints, tile.numSimplified);\n                        console.timeEnd('creation');\n                    }\n                    const key = `z${  z}`;\n                    this.stats[key] = (this.stats[key] || 0) + 1;\n                    this.total++;\n                }\n            }\n\n            // save reference to original geometry in tile so that we can drill down later if we stop now\n            tile.source = features;\n\n            // if it's the first-pass tiling\n            if (cz == null) {\n                // stop tiling if we reached max zoom, or if the tile is too simple\n                if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n            // if a drilldown to a specific tile\n            } else if (z === options.maxZoom || z === cz) {\n                // stop tiling if we reached base zoom or our target tile zoom\n                continue;\n            } else if (cz != null) {\n                // stop tiling if it's not an ancestor of the target tile\n                const zoomSteps = cz - z;\n                if (x !== cx >> zoomSteps || y !== cy >> zoomSteps) continue;\n            }\n\n            // if we slice further down, no need to keep source geometry\n            tile.source = null;\n\n            if (!features.length) continue;\n\n            if (debug > 1) console.time('clipping');\n\n            // values we'll use for clipping\n            const k1 = 0.5 * options.buffer / options.extent;\n            const k2 = 0.5 - k1;\n            const k3 = 0.5 + k1;\n            const k4 = 1 + k1;\n\n            let tl = null;\n            let bl = null;\n            let tr = null;\n            let br = null;\n\n            const left  = clip(features, z2, x - k1, x + k3, 0, tile.minX, tile.maxX, options);\n            const right = clip(features, z2, x + k2, x + k4, 0, tile.minX, tile.maxX, options);\n\n            if (left) {\n                tl = clip(left, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n                bl = clip(left, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n            }\n\n            if (right) {\n                tr = clip(right, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n                br = clip(right, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n            }\n\n            if (debug > 1) console.timeEnd('clipping');\n\n            stack.push(tl || [], z + 1, x * 2,     y * 2);\n            stack.push(bl || [], z + 1, x * 2,     y * 2 + 1);\n            stack.push(tr || [], z + 1, x * 2 + 1, y * 2);\n            stack.push(br || [], z + 1, x * 2 + 1, y * 2 + 1);\n        }\n    }\n\n    /**\n     * Given z, x, and y tile coordinates, returns the corresponding tile with geometries in tile coordinates, much like MVT data is stored.\n     * @param z - tile zoom level\n     * @param x - tile x coordinate\n     * @param y - tile y coordinate\n     * @returns the transformed tile or null if not found\n     */\n    getTile(z: number | string, x: number | string, y: number | string): GeoJSONVTTile | null {\n        z = +z;\n        x = +x;\n        y = +y;\n\n        const options = this.options;\n        const {extent, debug} = options;\n\n        if (z < 0 || z > 24) return null;\n\n        const z2 = 1 << z;\n        x = (x + z2) & (z2 - 1); // wrap tile x coordinate\n\n        const id = toID(z, x, y);\n        if (this.tiles[id]) {\n            return transformTile(this.tiles[id], extent);\n        }\n\n        if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n        let z0 = z;\n        let x0 = x;\n        let y0 = y;\n        let parent;\n\n        while (!parent && z0 > 0) {\n            z0--;\n            x0 = x0 >> 1;\n            y0 = y0 >> 1;\n            parent = this.tiles[toID(z0, x0, y0)];\n        }\n\n        if (!parent?.source) return null;\n\n        // if we found a parent tile containing the original geometry, we can drill down from it\n        if (debug > 1) {\n            console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n            console.time('drilling down');\n        }\n        this.splitTile(parent.source, z0, x0, y0, z, x, y);\n        if (debug > 1) console.timeEnd('drilling down');\n\n        if (!this.tiles[id]) return null;\n\n        return transformTile(this.tiles[id], extent);\n    }\n\n    /**\n     * Invalidates (removes) tiles affected by the provided features\n     * @internal\n     * @param features \n     */\n    invalidateTiles(features: GeoJSONVTInternalFeature[]) {\n        const options = this.options;\n        const {debug} = options;\n\n        // calculate bounding box of all features for trivial reject\n        let minX = Infinity;\n        let maxX = -Infinity;\n        let minY = Infinity;\n        let maxY = -Infinity;\n\n        for (const feature of features) {\n            minX = Math.min(minX, feature.minX);\n            maxX = Math.max(maxX, feature.maxX);\n            minY = Math.min(minY, feature.minY);\n            maxY = Math.max(maxY, feature.maxY);\n        }\n\n        // tile buffer clipping value - not halved as in splitTile above because checking against tile's own extent\n        const k1 = options.buffer / options.extent;\n\n        // track removed tile ids for o(1) lookup\n        const removedLookup = new Set();\n\n        // iterate through existing tiles and remove ones that are affected by features\n        for (const id in this.tiles) {\n            const tile = this.tiles[id];\n\n            // calculate tile bounds including buffer\n            const z2 = 1 << tile.z;\n            const tileMinX = (tile.x     - k1) / z2;\n            const tileMaxX = (tile.x + 1 + k1) / z2;\n            const tileMinY = (tile.y     - k1) / z2;\n            const tileMaxY = (tile.y + 1 + k1) / z2;\n\n            // trivial reject if feature bounds don't intersect tile\n            if (maxX < tileMinX || minX >= tileMaxX ||\n                maxY < tileMinY || minY >= tileMaxY) {\n                continue;\n            }\n\n            // check if any feature intersects with the tile\n            let intersects = false;\n            for (const feature of features) {\n                if (feature.maxX >= tileMinX && feature.minX < tileMaxX &&\n                    feature.maxY >= tileMinY && feature.minY < tileMaxY) {\n                    intersects = true;\n                    break;\n                }\n            }\n            if (!intersects) continue;\n\n            if (debug) {\n                if (debug > 1) {\n                    console.log('invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n                        tile.z, tile.x, tile.y, tile.numFeatures, tile.numPoints, tile.numSimplified);\n                }\n                const key = `z${  tile.z}`;\n                this.stats[key] = (this.stats[key] || 0) - 1;\n                this.total--;\n            }\n\n            delete this.tiles[id];\n            removedLookup.add(id);\n        }\n\n        // remove tile coords that are no longer in the index\n        if (removedLookup.size) {\n            this.tileCoords = this.tileCoords.filter(c => !removedLookup.has(c.id));\n        }\n    }\n\n    /**\n     * Updates the tile index by adding and/or removing geojson features\n     * invalidates tiles that are affected by the update for regeneration on next getTile call.\n     * @param diff - the source diff object\n     */\n    updateData(diff: GeoJSONVTSourceDiff) {\n        const options = this.options;\n        const debug = options.debug;\n\n        if (!options.updateable) throw new Error('to update tile geojson `updateable` option must be set to true');\n\n        // apply diff and collect affected features and updated source that will be used to invalidate tiles\n        const {affected, source} = applySourceDiff(this.source, diff, options);\n\n        // nothing has changed\n        if (!affected.length) return;\n\n        // update source with new simplified feature set\n        this.source = source;\n\n        if (debug > 1) {\n            console.log('invalidating tiles');\n            console.time('invalidating');\n        }\n\n        this.invalidateTiles(affected);\n\n        if (debug > 1) console.timeEnd('invalidating');\n\n        // re-generate root tile with updated feature set\n        const [z, x, y] = [0, 0, 0];\n        const rootTile = createTile(this.source, z, x, y, this.options);\n        rootTile.source = this.source;\n\n        // update tile index with new root tile - ready for getTile calls\n        const id = toID(z, x, y);\n        this.tiles[id] = rootTile;\n        this.tileCoords.push({z, x, y, id});\n\n        if (debug) {\n            const key = `z${  z}`;\n            this.stats[key] = (this.stats[key] || 0) + 1;\n            this.total++;\n        }\n    }\n}\n\nfunction toID(z: number, x: number, y: number): number {\n    return (((1 << z) * y + x) * 32) + z;\n}\n\nexport default function geojsonvt(data: GeoJSON.GeoJSON, options?: GeoJSONVTOptions) {\n    return new GeoJSONVT(data, options);\n}\n\nexport type { \n    GeoJSONVTInternalFeature, \n    GeoJSONVTOptions, \n    GeoJSONVTInternalTile, \n    GeoJSONVTInternalTileFeature, \n    GeometryType,\n    PartialGeoJSONVTFeature,\n    GeoJSONVT,\n    GeometryTypeMap,\n    StartEndSizeArray,\n    GeoJSONVTTile,\n    GeoJSONVTFeature,\n    GeoJSONVTSourceDiff,\n    GeoJSONVTFeatureDiff,\n    GeoJSONVTFeaturePoint,\n    GeoJSONVTFeatureNonPoint,\n    GeoJSONVTInternalTileFeaturePoint,\n    GeoJSONVTInternalTileFeaturNonPoint\n};\n"],"names":[],"mappings":"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"}