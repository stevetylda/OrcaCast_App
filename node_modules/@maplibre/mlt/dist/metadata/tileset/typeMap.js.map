{"version":3,"file":"typeMap.js","sourceRoot":"","sources":["../../../src/metadata/tileset/typeMap.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    type Column,\n    ColumnScope,\n    type ComplexColumn,\n    ComplexType,\n    type ScalarColumn,\n    ScalarType,\n} from \"./tilesetMetadata\";\n\n/**\n * The type code is a single varint32 that encodes:\n * - Physical or logical type\n * - Nullable flag\n * - Whether the column has a name (typeCode >= 10)\n * - Whether the column has children (typeCode == 30 for STRUCT)\n * - For ID types: whether it uses long (64-bit) IDs\n */\n\n/**\n * Decodes a type code into a Column structure.\n * ID columns (0-3) are represented as physical UINT_32 or UINT_64 types in TypeScript\n */\nexport function decodeColumnType(typeCode: number): Column | null {\n    switch (typeCode) {\n        case 0:\n        case 1:\n        case 2:\n        case 3: {\n            // ID columns: 0=uint32, 1=uint64, 2=nullable uint32, 3=nullable uint64\n            const column = {} as Column;\n            column.nullable = (typeCode & 1) !== 0; // Bit 0 = nullable;\n            column.columnScope = ColumnScope.FEATURE;\n            const scalarCol = {} as ScalarColumn;\n            // Map to physical type since TS schema doesn't have LogicalScalarType.ID\n            const physicalType = typeCode > 1 ? ScalarType.UINT_64 : ScalarType.UINT_32; // Bit 1 = longID\n            scalarCol.physicalType = physicalType;\n            scalarCol.type = \"physicalType\";\n            column.scalarType = scalarCol;\n            column.type = \"scalarType\";\n            return column;\n        }\n        case 4: {\n            // GEOMETRY (non-nullable, no children)\n            const column = {} as Column;\n            column.nullable = false;\n            column.columnScope = ColumnScope.FEATURE;\n            const complexCol = {} as ComplexColumn;\n            complexCol.type = \"physicalType\";\n            complexCol.physicalType = ComplexType.GEOMETRY;\n            column.type = \"complexType\";\n            column.complexType = complexCol;\n            return column;\n        }\n        case 30: {\n            // STRUCT (non-nullable with children)\n            const column = {} as Column;\n            column.nullable = false;\n            column.columnScope = ColumnScope.FEATURE;\n            const complexCol = {} as ComplexColumn;\n            complexCol.type = \"physicalType\";\n            complexCol.physicalType = ComplexType.STRUCT;\n            column.type = \"complexType\";\n            column.complexType = complexCol;\n            return column;\n        }\n        default:\n            return mapScalarType(typeCode);\n    }\n}\n\n/**\n * Returns true if this type code requires a name to be stored.\n * ID (0-3) and GEOMETRY (4) columns have implicit names.\n * All other types (>= 10) require explicit names.\n */\nexport function columnTypeHasName(typeCode: number): boolean {\n    return typeCode >= 10;\n}\n\n/**\n * Returns true if this type code has child fields.\n * Only STRUCT (typeCode 30) has children.\n */\nexport function columnTypeHasChildren(typeCode: number): boolean {\n    return typeCode === 30;\n}\n\n/**\n * Determines if a stream count needs to be read for this column.\n * Mirrors the logic in cpp/include/mlt/metadata/type_map.hpp lines 81-118\n */\nexport function hasStreamCount(column: Column): boolean {\n    // ID columns don't have stream count (identified by name)\n    if (column.name === \"id\") {\n        return false;\n    }\n\n    if (column.type === \"scalarType\") {\n        const scalarCol = column.scalarType;\n\n        if (scalarCol.type === \"physicalType\") {\n            const physicalType = scalarCol.physicalType;\n            switch (physicalType) {\n                case ScalarType.BOOLEAN:\n                case ScalarType.INT_8:\n                case ScalarType.UINT_8:\n                case ScalarType.INT_32:\n                case ScalarType.UINT_32:\n                case ScalarType.INT_64:\n                case ScalarType.UINT_64:\n                case ScalarType.FLOAT:\n                case ScalarType.DOUBLE:\n                    return false;\n                case ScalarType.STRING:\n                    return true;\n                default:\n                    return false;\n            }\n        } else if (scalarCol.type === \"logicalType\") {\n            return false;\n        }\n    } else if (column.type === \"complexType\") {\n        const complexCol = column.complexType;\n\n        if (complexCol.type === \"physicalType\") {\n            const physicalType = complexCol.physicalType;\n            switch (physicalType) {\n                case ComplexType.GEOMETRY:\n                case ComplexType.STRUCT:\n                    return true;\n                default:\n                    return false;\n            }\n        }\n    }\n\n    console.warn(\"Unexpected column type in hasStreamCount\", column);\n    return false;\n}\n\n/**\n * Maps a scalar type code to a Column with ScalarType.\n * Type codes 10-29 encode scalar types with nullable flag.\n * Even codes are non-nullable, odd codes are nullable.\n */\nfunction mapScalarType(typeCode: number): Column | null {\n    let scalarType: number | null = null;\n\n    switch (typeCode) {\n        case 10:\n        case 11:\n            scalarType = ScalarType.BOOLEAN;\n            break;\n        case 12:\n        case 13:\n            scalarType = ScalarType.INT_8;\n            break;\n        case 14:\n        case 15:\n            scalarType = ScalarType.UINT_8;\n            break;\n        case 16:\n        case 17:\n            scalarType = ScalarType.INT_32;\n            break;\n        case 18:\n        case 19:\n            scalarType = ScalarType.UINT_32;\n            break;\n        case 20:\n        case 21:\n            scalarType = ScalarType.INT_64;\n            break;\n        case 22:\n        case 23:\n            scalarType = ScalarType.UINT_64;\n            break;\n        case 24:\n        case 25:\n            scalarType = ScalarType.FLOAT;\n            break;\n        case 26:\n        case 27:\n            scalarType = ScalarType.DOUBLE;\n            break;\n        case 28:\n        case 29:\n            scalarType = ScalarType.STRING;\n            break;\n        default:\n            return null;\n    }\n\n    const column = {} as Column;\n    column.nullable = (typeCode & 1) !== 0;\n    column.columnScope = ColumnScope.FEATURE;\n    const scalarCol = {} as ScalarColumn;\n    scalarCol.type = \"physicalType\";\n    scalarCol.physicalType = scalarType;\n    column.type = \"scalarType\";\n    column.scalarType = scalarCol;\n    return column;\n}\n"]}