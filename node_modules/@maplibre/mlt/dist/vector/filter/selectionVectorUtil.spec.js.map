{"version":3,"file":"selectionVectorUtil.spec.js","sourceRoot":"","sources":["../../../src/vector/filter/selectionVectorUtil.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { describe, it, expect } from \"vitest\";\nimport {\n    createSelectionVector,\n    createNullableSelectionVector,\n    updateNullableSelectionVector,\n} from \"./selectionVectorUtils\";\nimport { FlatSelectionVector } from \"./flatSelectionVector\";\nimport { SequenceSelectionVector } from \"./sequenceSelectionVector\";\nimport BitVector from \"../flat/bitVector\";\n\ndescribe(\"selectionVectorUtils\", () => {\n    describe(\"createSelectionVector\", () => {\n        it(\"Should create a SequenceSelectionVector with given size\", () => {\n            const sv = createSelectionVector(5);\n            expect(sv).toBeInstanceOf(SequenceSelectionVector);\n            expect(sv.limit).toBe(5);\n        });\n\n        it(\"Should handle zero size\", () => {\n            const sv = createSelectionVector(0);\n            expect(sv).toBeInstanceOf(SequenceSelectionVector);\n            expect(sv.limit).toBe(0);\n        });\n    });\n\n    describe(\"createNullableSelectionVector\", () => {\n        it(\"Should return all indices when nullabilityBuffer is not provided\", () => {\n            const sv = createNullableSelectionVector(5);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(5);\n        });\n\n        it(\"Should return empty vector when size is 0 and nullabilityBuffer is not provided\", () => {\n            const sv = createNullableSelectionVector(0);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(0);\n        });\n\n        it(\"Should return empty vector when size is 0 with BitVector provided\", () => {\n            const buffer = new Uint8Array([0b11111111]);\n            const bitVector = new BitVector(buffer, 8);\n            const sv = createNullableSelectionVector(0, bitVector);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(0);\n        });\n\n        it(\"Should create FlatSelectionVector with only set bits\", () => {\n            const buffer = new Uint8Array([0b00001011]); // bits 0, 1, 3 are set\n            const bitVector = new BitVector(buffer, 8);\n            const sv = createNullableSelectionVector(8, bitVector);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(3);\n        });\n\n        it(\"Should create empty vector when no bits are set\", () => {\n            const buffer = new Uint8Array([0b00000000]);\n            const bitVector = new BitVector(buffer, 8);\n            const sv = createNullableSelectionVector(8, bitVector);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(0);\n        });\n\n        it(\"Should handle multiple bytes in BitVector\", () => {\n            const buffer = new Uint8Array([0b10101010, 0b01010101]);\n            const bitVector = new BitVector(buffer, 16);\n            const sv = createNullableSelectionVector(16, bitVector);\n            expect(sv).toBeInstanceOf(FlatSelectionVector);\n            expect(sv.limit).toBe(8);\n        });\n    });\n\n    describe(\"updateNullableSelectionVector\", () => {\n        describe(\"with FlatSelectionVector\", () => {\n            it(\"Should return new instance when filtering with BitVector\", () => {\n                const selectionVector = new FlatSelectionVector([0, 1, 2, 3, 4, 5, 6, 7]);\n                const buffer = new Uint8Array([0b00001011]);\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(3);\n                expect(result).not.toBe(selectionVector);\n            });\n\n            it(\"Should return same instance when BitVector is null\", () => {\n                const selectionVector = new FlatSelectionVector([0, 1, 2, 3, 4, 5, 6, 7]);\n                const result = updateNullableSelectionVector(selectionVector, null);\n                expect(result).toStrictEqual(selectionVector);\n            });\n\n            it(\"Should return all indices when nullabilityBuffer is undefined\", () => {\n                const selectionVector = new FlatSelectionVector([0, 2, 4, 6]);\n                const result = updateNullableSelectionVector(selectionVector, undefined);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(4);\n            });\n\n            it(\"Should keep all indices when all bits are set\", () => {\n                const selectionVector = new FlatSelectionVector([0, 2, 4, 6]);\n                const buffer = new Uint8Array([0b01010101]);\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(4);\n            });\n\n            it(\"Should filter out null indices from selection vector\", () => {\n                const selectionVector = new FlatSelectionVector([0, 2, 4, 6]);\n                const buffer = new Uint8Array([0b01000101]); // bits at 0, 2, 6\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(3);\n            });\n\n            it(\"Should return empty vector when all selected indices are null\", () => {\n                const selectionVector = new FlatSelectionVector([1, 3, 5]);\n                const buffer = new Uint8Array([0b01010101]); // bits at 0, 2, 4, 6 (not 1, 3, 5)\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(0);\n            });\n\n            it(\"Should handle empty FlatSelectionVector\", () => {\n                const selectionVector = new FlatSelectionVector([]);\n                const buffer = new Uint8Array([0b11111111]);\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(0);\n            });\n\n            it(\"Should filter large index values from selection vector\", () => {\n                const selectionVector = new FlatSelectionVector([0, 8, 16]);\n                const buffer = new Uint8Array([0b00000001, 0b00000000, 0b00000000]);\n                const bitVector = new BitVector(buffer, 24);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(1);\n            });\n        });\n\n        describe(\"with SequenceSelectionVector\", () => {\n            it(\"Should filter SequenceSelectionVector with all bits set\", () => {\n                const selectionVector = new SequenceSelectionVector(0, 2, 4); // [0, 2, 4, 6]\n                const buffer = new Uint8Array([0b01010101]);\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(4);\n            });\n\n            it(\"Should partially filter SequenceSelectionVector\", () => {\n                const selectionVector = new SequenceSelectionVector(0, 2, 4); // [0, 2, 4, 6]\n                const buffer = new Uint8Array([0b00010001]); // bits at 0, 4\n                const bitVector = new BitVector(buffer, 8);\n                const result = updateNullableSelectionVector(selectionVector, bitVector);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(2);\n            });\n\n            it(\"Should preserve all SequenceSelectionVector values when nullabilityBuffer is undefined\", () => {\n                const selectionVector = new SequenceSelectionVector(1, 3, 3); // [1, 4, 7]\n                const result = updateNullableSelectionVector(selectionVector, undefined);\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(3);\n            });\n\n            it(\"Should create FlatSelectionVector when BitVector is null\", () => {\n                const selectionVector = new SequenceSelectionVector(0, 2, 4); // [0, 2, 4, 6]\n                const result = updateNullableSelectionVector(selectionVector, null);\n\n                expect(result).toBeInstanceOf(FlatSelectionVector);\n                expect(result.limit).toBe(4);\n            });\n        });\n    });\n});\n"]}