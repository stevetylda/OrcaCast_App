{"version":3,"file":"@deck__gl_mapbox.js","names":["Deck","GlobeView","MapView","UNDEFINED_BEFORE_ID","Deck"],"sources":["../../@deck.gl/mapbox/dist/deck-utils.js","../../@deck.gl/mapbox/dist/mapbox-layer.js","../../@deck.gl/mapbox/dist/resolve-layers.js","../../@deck.gl/mapbox/dist/mapbox-layer-group.js","../../@deck.gl/mapbox/dist/resolve-layer-groups.js","../../@deck.gl/mapbox/dist/mapbox-overlay.js"],"sourcesContent":["// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Deck, MapView, _GlobeView as GlobeView, _flatten as flatten } from '@deck.gl/core';\nimport { lngLatToWorld, unitsPerMeter } from '@math.gl/web-mercator';\nconst MAPBOX_VIEW_ID = 'mapbox';\n// Mercator constants\nconst TILE_SIZE = 512;\nconst DEGREES_TO_RADIANS = Math.PI / 180;\n// Create an interleaved deck instance.\nexport function getDeckInstance({ map, gl, deck }) {\n    // Only create one deck instance per context\n    if (map.__deck) {\n        return map.__deck;\n    }\n    // Only initialize certain props once per context\n    const customRender = deck?.props._customRender;\n    const onLoad = deck?.props.onLoad;\n    const deckProps = {\n        ...deck?.props,\n        _customRender: () => {\n            map.triggerRepaint();\n            // customRender may be subscribed by DeckGL React component to update child props\n            // make sure it is still called\n            // Hack - do not pass a redraw reason here to prevent the React component from clearing the context\n            // Rerender will be triggered by MapboxLayer's render()\n            customRender?.('');\n        }\n    };\n    deckProps.parameters = { ...getDefaultParameters(map, true), ...deckProps.parameters };\n    deckProps.views || (deckProps.views = getDefaultView(map));\n    let deckInstance;\n    if (!deck || deck.props.gl === gl) {\n        // If deck isn't defined (Internal MapboxLayer use case),\n        // or if deck is defined and is using the WebGLContext created by mapbox (MapboxOverlay and External MapboxLayer use case),\n        // block deck from setting the canvas size, and use the map's viewState to drive deck.\n        // Otherwise, we use deck's viewState to drive the map.\n        Object.assign(deckProps, {\n            gl,\n            width: null,\n            height: null,\n            touchAction: 'unset',\n            viewState: getViewState(map)\n        });\n        if (deck?.isInitialized) {\n            watchMapMove(deck, map);\n        }\n        else {\n            deckProps.onLoad = () => {\n                onLoad?.();\n                watchMapMove(deckInstance, map);\n            };\n        }\n    }\n    if (deck) {\n        deckInstance = deck;\n        deck.setProps(deckProps);\n        deck.userData.isExternal = true;\n    }\n    else {\n        deckInstance = new Deck(deckProps);\n        map.on('remove', () => {\n            removeDeckInstance(map);\n        });\n    }\n    deckInstance.userData.mapboxLayers = new Set();\n    // (deckInstance.userData as UserData).mapboxVersion = getMapboxVersion(map);\n    map.__deck = deckInstance;\n    map.on('render', () => {\n        if (deckInstance.isInitialized)\n            afterRender(deckInstance, map);\n    });\n    return deckInstance;\n}\nfunction watchMapMove(deck, map) {\n    const _handleMapMove = () => {\n        if (deck.isInitialized) {\n            // call view state methods\n            onMapMove(deck, map);\n        }\n        else {\n            // deregister itself when deck is finalized\n            map.off('move', _handleMapMove);\n        }\n    };\n    map.on('move', _handleMapMove);\n}\nexport function removeDeckInstance(map) {\n    map.__deck?.finalize();\n    map.__deck = null;\n}\nexport function getDefaultParameters(map, interleaved) {\n    const result = interleaved\n        ? {\n            depthWriteEnabled: true,\n            depthCompare: 'less-equal',\n            depthBias: 0,\n            blend: true,\n            blendColorSrcFactor: 'src-alpha',\n            blendColorDstFactor: 'one-minus-src-alpha',\n            blendAlphaSrcFactor: 'one',\n            blendAlphaDstFactor: 'one-minus-src-alpha',\n            blendColorOperation: 'add',\n            blendAlphaOperation: 'add'\n        }\n        : {};\n    if (getProjection(map) === 'globe') {\n        result.cullMode = 'back';\n    }\n    return result;\n}\nexport function addLayer(deck, layer) {\n    deck.userData.mapboxLayers.add(layer);\n    updateLayers(deck);\n}\nexport function removeLayer(deck, layer) {\n    deck.userData.mapboxLayers.delete(layer);\n    updateLayers(deck);\n}\nexport function updateLayer(deck, layer) {\n    updateLayers(deck);\n}\nexport function drawLayer(deck, map, layer, renderParameters) {\n    let { currentViewport } = deck.userData;\n    let clearStack = false;\n    if (!currentViewport) {\n        // This is the first layer drawn in this render cycle.\n        // Generate viewport from the current map state.\n        currentViewport = getViewport(deck, map, renderParameters);\n        deck.userData.currentViewport = currentViewport;\n        clearStack = true;\n    }\n    if (!deck.isInitialized) {\n        return;\n    }\n    deck._drawLayers('mapbox-repaint', {\n        viewports: [currentViewport],\n        layerFilter: params => (!deck.props.layerFilter || deck.props.layerFilter(params)) &&\n            (layer.id === params.layer.id || params.layer.props.operation.includes('terrain')),\n        clearStack,\n        clearCanvas: false\n    });\n}\nexport function drawLayerGroup(deck, map, group, renderParameters) {\n    let { currentViewport } = deck.userData;\n    let clearStack = false;\n    if (!currentViewport) {\n        // This is the first layer drawn in this render cycle.\n        // Generate viewport from the current map state.\n        currentViewport = getViewport(deck, map, renderParameters);\n        deck.userData.currentViewport = currentViewport;\n        clearStack = true;\n    }\n    if (!deck.isInitialized) {\n        return;\n    }\n    deck._drawLayers('mapbox-repaint', {\n        viewports: [currentViewport],\n        layerFilter: params => {\n            if (deck.props.layerFilter && !deck.props.layerFilter(params)) {\n                return false;\n            }\n            const layer = params.layer;\n            if (layer.props.beforeId === group.beforeId && layer.props.slot === group.slot) {\n                return true;\n            }\n            return false;\n        },\n        clearStack,\n        clearCanvas: false\n    });\n}\nexport function getProjection(map) {\n    const projection = map.getProjection?.();\n    const type = \n    // maplibre projection spec\n    projection?.type ||\n        // mapbox projection spec\n        projection?.name;\n    if (type === 'globe') {\n        return 'globe';\n    }\n    if (type && type !== 'mercator') {\n        throw new Error('Unsupported projection');\n    }\n    return 'mercator';\n}\nexport function getDefaultView(map) {\n    if (getProjection(map) === 'globe') {\n        return new GlobeView({ id: MAPBOX_VIEW_ID });\n    }\n    return new MapView({ id: MAPBOX_VIEW_ID });\n}\nexport function getViewState(map) {\n    const { lng, lat } = map.getCenter();\n    const viewState = {\n        // Longitude returned by getCenter can be outside of [-180, 180] when zooming near the anti meridian\n        // https://github.com/visgl/deck.gl/issues/6894\n        longitude: ((lng + 540) % 360) - 180,\n        latitude: lat,\n        zoom: map.getZoom(),\n        bearing: map.getBearing(),\n        pitch: map.getPitch(),\n        padding: map.getPadding(),\n        repeat: map.getRenderWorldCopies()\n    };\n    if (map.getTerrain?.()) {\n        // When the base map has terrain, we need to target the camera at the terrain surface\n        centerCameraOnTerrain(map, viewState);\n    }\n    return viewState;\n}\nfunction centerCameraOnTerrain(map, viewState) {\n    if (map.getFreeCameraOptions) {\n        // mapbox-gl v2\n        const { position } = map.getFreeCameraOptions();\n        if (!position || position.z === undefined) {\n            return;\n        }\n        // @ts-ignore transform is not typed\n        const height = map.transform.height;\n        const { longitude, latitude, pitch } = viewState;\n        // Convert mapbox mercator coordinate to deck common space\n        const cameraX = position.x * TILE_SIZE;\n        const cameraY = (1 - position.y) * TILE_SIZE;\n        const cameraZ = position.z * TILE_SIZE;\n        // Mapbox manipulates zoom in terrain mode, see discussion here: https://github.com/mapbox/mapbox-gl-js/issues/12040\n        const center = lngLatToWorld([longitude, latitude]);\n        const dx = cameraX - center[0];\n        const dy = cameraY - center[1];\n        const cameraToCenterDistanceGround = Math.sqrt(dx * dx + dy * dy);\n        const pitchRadians = pitch * DEGREES_TO_RADIANS;\n        const altitudePixels = 1.5 * height;\n        const scale = pitchRadians < 0.001\n            ? // Pitch angle too small to deduce the look at point, assume elevation is 0\n                (altitudePixels * Math.cos(pitchRadians)) / cameraZ\n            : (altitudePixels * Math.sin(pitchRadians)) / cameraToCenterDistanceGround;\n        viewState.zoom = Math.log2(scale);\n        const cameraZFromSurface = (altitudePixels * Math.cos(pitchRadians)) / scale;\n        const surfaceElevation = cameraZ - cameraZFromSurface;\n        viewState.position = [0, 0, surfaceElevation / unitsPerMeter(latitude)];\n    }\n    // @ts-ignore transform is not typed\n    else if (typeof map.transform.elevation === 'number') {\n        // maplibre-gl\n        // @ts-ignore transform is not typed\n        viewState.position = [0, 0, map.transform.elevation];\n    }\n}\nfunction getViewport(deck, map, renderParameters) {\n    const viewState = getViewState(map);\n    const { views } = deck.props;\n    const view = (views && flatten(views).find((v) => v.id === MAPBOX_VIEW_ID)) ||\n        getDefaultView(map);\n    if (renderParameters) {\n        // Called from MapboxLayer.render\n        // Magic number, matches mapbox-gl@>=1.3.0's projection matrix\n        view.props.nearZMultiplier = 0.2;\n    }\n    // Get the base map near/far plane\n    // renderParameters is maplibre API but not mapbox\n    // Transform is not an official API, properties could be undefined for older versions\n    const nearZ = renderParameters?.nearZ ?? map.transform._nearZ;\n    const farZ = renderParameters?.farZ ?? map.transform._farZ;\n    if (Number.isFinite(nearZ)) {\n        viewState.nearZ = nearZ / map.transform.height;\n        viewState.farZ = farZ / map.transform.height;\n    }\n    // Otherwise fallback to default calculation using nearZMultiplier/farZMultiplier\n    return view.makeViewport({\n        width: deck.width,\n        height: deck.height,\n        viewState\n    });\n}\nfunction afterRender(deck, map) {\n    const { mapboxLayers, isExternal } = deck.userData;\n    if (isExternal) {\n        // Draw non-Mapbox layers\n        const mapboxLayerIds = Array.from(mapboxLayers, layer => layer.id);\n        const deckLayers = flatten(deck.props.layers, Boolean);\n        const hasNonMapboxLayers = deckLayers.some(layer => layer && !mapboxLayerIds.includes(layer.id));\n        let viewports = deck.getViewports();\n        const mapboxViewportIdx = viewports.findIndex(vp => vp.id === MAPBOX_VIEW_ID);\n        const hasNonMapboxViews = viewports.length > 1 || mapboxViewportIdx < 0;\n        if (hasNonMapboxLayers || hasNonMapboxViews) {\n            if (mapboxViewportIdx >= 0) {\n                viewports = viewports.slice();\n                viewports[mapboxViewportIdx] = getViewport(deck, map);\n            }\n            deck._drawLayers('mapbox-repaint', {\n                viewports,\n                layerFilter: params => (!deck.props.layerFilter || deck.props.layerFilter(params)) &&\n                    (params.viewport.id !== MAPBOX_VIEW_ID || !mapboxLayerIds.includes(params.layer.id)),\n                clearCanvas: false\n            });\n        }\n    }\n    // End of render cycle, clear generated viewport\n    deck.userData.currentViewport = null;\n}\nfunction onMapMove(deck, map) {\n    deck.setProps({\n        viewState: getViewState(map)\n    });\n    // Camera changed, will trigger a map repaint right after this\n    // Clear any change flag triggered by setting viewState so that deck does not request\n    // a second repaint\n    deck.needsRedraw({ clearRedrawFlags: true });\n}\nfunction updateLayers(deck) {\n    if (deck.userData.isExternal) {\n        return;\n    }\n    const layers = [];\n    deck.userData.mapboxLayers.forEach(deckLayer => {\n        const LayerType = deckLayer.props.type;\n        const layer = new LayerType(deckLayer.props);\n        layers.push(layer);\n    });\n    deck.setProps({ layers });\n}\n//# sourceMappingURL=deck-utils.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { getDeckInstance, addLayer, removeLayer, updateLayer, drawLayer } from \"./deck-utils.js\";\nexport default class MapboxLayer {\n    /* eslint-disable no-this-before-super */\n    constructor(props) {\n        if (!props.id) {\n            throw new Error('Layer must have an unique id');\n        }\n        this.id = props.id;\n        this.type = 'custom';\n        this.renderingMode = props.renderingMode || '3d';\n        this.slot = props.slot;\n        this.map = null;\n        this.deck = null;\n        this.props = props;\n    }\n    /* Mapbox custom layer methods */\n    onAdd(map, gl) {\n        this.map = map;\n        this.deck = getDeckInstance({ map, gl, deck: this.props.deck });\n        addLayer(this.deck, this);\n    }\n    onRemove() {\n        if (this.deck) {\n            removeLayer(this.deck, this);\n        }\n    }\n    setProps(props) {\n        // id cannot be changed\n        Object.assign(this.props, props, { id: this.id });\n        // safe guard in case setProps is called before onAdd\n        if (this.deck) {\n            updateLayer(this.deck, this);\n        }\n    }\n    render(gl, renderParameters) {\n        drawLayer(this.deck, this.map, this, renderParameters);\n    }\n}\n//# sourceMappingURL=mapbox-layer.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { _flatten as flatten } from '@deck.gl/core';\nimport MapboxLayer from \"./mapbox-layer.js\";\nconst UNDEFINED_BEFORE_ID = '__UNDEFINED__';\n/** Insert Deck layers into the mapbox Map according to the user-defined order */\n// eslint-disable-next-line complexity, max-statements\nexport function resolveLayers(map, deck, oldLayers, newLayers) {\n    // Wait until map style is loaded\n    // @ts-ignore non-public map property\n    if (!map || !deck || !map.style || !map.style._loaded) {\n        return;\n    }\n    const layers = flatten(newLayers, Boolean);\n    if (oldLayers !== newLayers) {\n        // Step 1: remove layers that no longer exist\n        const prevLayers = flatten(oldLayers, Boolean);\n        const prevLayerIds = new Set(prevLayers.map(l => l.id));\n        for (const layer of layers) {\n            prevLayerIds.delete(layer.id);\n        }\n        for (const id of prevLayerIds) {\n            if (map.getLayer(id)) {\n                map.removeLayer(id);\n            }\n        }\n    }\n    // Step 2: add missing layers\n    for (const layer of layers) {\n        const mapboxLayer = map.getLayer(layer.id);\n        if (mapboxLayer) {\n            // Mapbox's map.getLayer() had a breaking change in v3.6.0, see https://github.com/visgl/deck.gl/issues/9086\n            // @ts-expect-error not typed\n            const layerInstance = mapboxLayer.implementation || mapboxLayer;\n            layerInstance.setProps(layer.props);\n        }\n        else {\n            map.addLayer(new MapboxLayer({\n                id: layer.id,\n                deck,\n                // @ts-expect-error slot is not defined in LayerProps\n                slot: layer.props.slot\n            }), \n            // @ts-expect-error beforeId is not defined in LayerProps\n            layer.props.beforeId);\n        }\n    }\n    // Step 3: check the order of layers\n    // If beforeId is defined, the deck layer should always render before the mapbox layer [beforeId]\n    // If beforeId is not defined, the deck layer should appear after all mapbox layers\n    // When two deck layers share the same beforeId, they are rendered in the order that is passed into Deck props.layers\n    // @ts-ignore non-public map property\n    const mapLayers = map.style._order;\n    // Group deck layers by beforeId\n    const layerGroups = {};\n    for (const layer of layers) {\n        // @ts-expect-error beforeId is not defined in LayerProps\n        let { beforeId } = layer.props;\n        if (!beforeId || !mapLayers.includes(beforeId)) {\n            beforeId = UNDEFINED_BEFORE_ID;\n        }\n        layerGroups[beforeId] = layerGroups[beforeId] || [];\n        layerGroups[beforeId].push(layer.id);\n    }\n    for (const beforeId in layerGroups) {\n        const layerGroup = layerGroups[beforeId];\n        let lastLayerIndex = beforeId === UNDEFINED_BEFORE_ID ? mapLayers.length : mapLayers.indexOf(beforeId);\n        let lastLayerId = beforeId === UNDEFINED_BEFORE_ID ? undefined : beforeId;\n        for (let i = layerGroup.length - 1; i >= 0; i--) {\n            const layerId = layerGroup[i];\n            const layerIndex = mapLayers.indexOf(layerId);\n            if (layerIndex !== lastLayerIndex - 1) {\n                map.moveLayer(layerId, lastLayerId);\n                if (layerIndex > lastLayerIndex) {\n                    // The last layer's index have changed\n                    lastLayerIndex++;\n                }\n            }\n            lastLayerIndex--;\n            lastLayerId = layerId;\n        }\n    }\n}\n//# sourceMappingURL=resolve-layers.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { getDeckInstance, drawLayerGroup } from \"./deck-utils.js\";\nimport { assert } from '@deck.gl/core';\nexport default class MapboxLayerGroup {\n    /* eslint-disable no-this-before-super */\n    constructor(props) {\n        assert(props.id, 'id is required');\n        this.id = props.id;\n        this.type = 'custom';\n        this.renderingMode = props.renderingMode || '3d';\n        this.slot = props.slot;\n        this.beforeId = props.beforeId;\n        this.map = null;\n        this.deck = null;\n    }\n    /* Mapbox custom layer methods */\n    onAdd(map, gl) {\n        this.map = map;\n        this.deck = getDeckInstance({ map, gl });\n    }\n    render(gl, renderParameters) {\n        if (!this.deck || !this.map)\n            return;\n        drawLayerGroup(this.deck, this.map, this, renderParameters);\n    }\n}\n//# sourceMappingURL=mapbox-layer-group.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { _flatten as flatten } from '@deck.gl/core';\nimport MapboxLayerGroup from \"./mapbox-layer-group.js\";\nconst UNDEFINED_BEFORE_ID = '__UNDEFINED__';\nfunction getLayerGroupId(layer) {\n    if (layer.props.beforeId) {\n        return `deck-layer-group-before:${layer.props.beforeId}`;\n    }\n    else if (layer.props.slot) {\n        return `deck-layer-group-slot:${layer.props.slot}`;\n    }\n    return 'deck-layer-group-last';\n}\n/** Group Deck layers into buckets (by beforeId or slot) and insert them\n *  into the mapbox Map according to the user-defined order\n **/\n// eslint-disable-next-line complexity, max-statements\nexport function resolveLayerGroups(map, oldLayers, newLayers) {\n    // Wait until map style is loaded\n    // @ts-ignore non-public map property\n    if (!map || !map.style || !map.style._loaded) {\n        return;\n    }\n    const layers = flatten(newLayers, Boolean);\n    if (oldLayers !== newLayers) {\n        // Step 1: remove \"group\" layers that no longer exist\n        const prevLayers = flatten(oldLayers, Boolean);\n        const prevLayerGroupIds = new Set(prevLayers.map(l => getLayerGroupId(l)));\n        const newLayerGroupIds = new Set(layers.map(l => getLayerGroupId(l)));\n        for (const groupId of prevLayerGroupIds) {\n            if (!newLayerGroupIds.has(groupId)) {\n                if (map.getLayer(groupId)) {\n                    map.removeLayer(groupId);\n                }\n            }\n        }\n    }\n    // Step 2: add missing \"group\" layers\n    const layerGroups = {};\n    for (const layer of layers) {\n        const groupId = getLayerGroupId(layer);\n        const mapboxGroup = map.getLayer(groupId);\n        if (mapboxGroup) {\n            // Mapbox's map.getLayer() had a breaking change in v3.6.0, see https://github.com/visgl/deck.gl/issues/9086\n            // @ts-expect-error not typed\n            const groupInstance = mapboxGroup.implementation || mapboxGroup;\n            layerGroups[groupId] = groupInstance;\n        }\n        else {\n            const newGroup = new MapboxLayerGroup({\n                id: groupId,\n                slot: layer.props.slot,\n                beforeId: layer.props.beforeId\n            });\n            layerGroups[groupId] = newGroup;\n            map.addLayer(newGroup, layer.props.beforeId);\n        }\n    }\n    // Step 3: check the order of layers\n    // If beforeId move \"group\" layers to proper position in the mapbox layer order\n    // @ts-ignore non-public map property\n    const mapLayers = map.style._order;\n    for (const [groupId, group] of Object.entries(layerGroups)) {\n        const beforeId = group.beforeId || UNDEFINED_BEFORE_ID;\n        const expectedGroupIndex = beforeId === UNDEFINED_BEFORE_ID ? mapLayers.length : mapLayers.indexOf(beforeId);\n        const currentGropupIndex = mapLayers.indexOf(groupId);\n        if (currentGropupIndex !== expectedGroupIndex - 1) {\n            const moveBeforeId = beforeId === UNDEFINED_BEFORE_ID ? undefined : beforeId;\n            map.moveLayer(groupId, moveBeforeId);\n        }\n    }\n}\n//# sourceMappingURL=resolve-layer-groups.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Deck, assert } from '@deck.gl/core';\nimport { getViewState, getDefaultView, getDeckInstance, removeDeckInstance, getDefaultParameters, getProjection } from \"./deck-utils.js\";\nimport { log } from '@deck.gl/core';\nimport { resolveLayers } from \"./resolve-layers.js\";\nimport { resolveLayerGroups } from \"./resolve-layer-groups.js\";\n/**\n * Implements Mapbox [IControl](https://docs.mapbox.com/mapbox-gl-js/api/markers/#icontrol) interface\n * Renders deck.gl layers over the base map and automatically synchronizes with the map's camera\n */\nexport default class MapboxOverlay {\n    constructor(props) {\n        this._handleStyleChange = () => {\n            this._resolveLayers(this._map, this._deck, this._props.layers, this._props.layers);\n            if (!this._map)\n                return;\n            // getProjection() returns undefined before style is loaded\n            const projection = getProjection(this._map);\n            if (projection && !this._props.views) {\n                this._deck?.setProps({ views: getDefaultView(this._map) });\n            }\n        };\n        this._updateContainerSize = () => {\n            if (this._map && this._container) {\n                const { clientWidth, clientHeight } = this._map.getContainer();\n                Object.assign(this._container.style, {\n                    width: `${clientWidth}px`,\n                    height: `${clientHeight}px`\n                });\n            }\n        };\n        this._updateViewState = () => {\n            const deck = this._deck;\n            const map = this._map;\n            if (deck && map) {\n                deck.setProps({\n                    views: this._props.views || getDefaultView(map),\n                    viewState: getViewState(map)\n                });\n                // Redraw immediately if view state has changed\n                if (deck.isInitialized) {\n                    deck.redraw();\n                }\n            }\n        };\n        // eslint-disable-next-line complexity\n        this._handleMouseEvent = (event) => {\n            const deck = this._deck;\n            if (!deck || !deck.isInitialized) {\n                return;\n            }\n            const mockEvent = {\n                type: event.type,\n                offsetCenter: event.point,\n                srcEvent: event\n            };\n            const lastDown = this._lastMouseDownPoint;\n            if (!event.point && lastDown) {\n                // drag* events do not contain a `point` field\n                mockEvent.deltaX = event.originalEvent.clientX - lastDown.clientX;\n                mockEvent.deltaY = event.originalEvent.clientY - lastDown.clientY;\n                mockEvent.offsetCenter = {\n                    x: lastDown.x + mockEvent.deltaX,\n                    y: lastDown.y + mockEvent.deltaY\n                };\n            }\n            switch (mockEvent.type) {\n                case 'mousedown':\n                    deck._onPointerDown(mockEvent);\n                    this._lastMouseDownPoint = {\n                        ...event.point,\n                        clientX: event.originalEvent.clientX,\n                        clientY: event.originalEvent.clientY\n                    };\n                    break;\n                case 'dragstart':\n                    mockEvent.type = 'panstart';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'drag':\n                    mockEvent.type = 'panmove';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'dragend':\n                    mockEvent.type = 'panend';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'click':\n                    mockEvent.tapCount = 1;\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'dblclick':\n                    mockEvent.type = 'click';\n                    mockEvent.tapCount = 2;\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'mousemove':\n                    mockEvent.type = 'pointermove';\n                    deck._onPointerMove(mockEvent);\n                    break;\n                case 'mouseout':\n                    mockEvent.type = 'pointerleave';\n                    deck._onPointerMove(mockEvent);\n                    break;\n                default:\n                    return;\n            }\n        };\n        const { interleaved = false } = props;\n        this._interleaved = interleaved;\n        this._renderLayersInGroups = props._renderLayersInGroups || false;\n        this._props = this.filterProps(props);\n    }\n    /** Filter out props to pass to Deck **/\n    filterProps(props) {\n        const { interleaved = false, useDevicePixels, ...deckProps } = props;\n        if (!interleaved && useDevicePixels !== undefined) {\n            // useDevicePixels cannot be used in interleaved mode\n            deckProps.useDevicePixels = useDevicePixels;\n        }\n        return deckProps;\n    }\n    /** Update (partial) props of the underlying Deck instance. */\n    setProps(props) {\n        if (this._interleaved && props.layers) {\n            this._resolveLayers(this._map, this._deck, this._props.layers, props.layers);\n        }\n        Object.assign(this._props, this.filterProps(props));\n        if (this._deck && this._map) {\n            this._deck.setProps({\n                ...this._props,\n                parameters: {\n                    ...getDefaultParameters(this._map, this._interleaved),\n                    ...this._props.parameters\n                }\n            });\n        }\n    }\n    // The local Map type is for internal typecheck only. It does not necesarily satisefy mapbox/maplibre types at runtime.\n    // Do not restrict the argument type here to avoid type conflict.\n    /** Called when the control is added to a map */\n    onAdd(map) {\n        this._map = map;\n        return this._interleaved ? this._onAddInterleaved(map) : this._onAddOverlaid(map);\n    }\n    _onAddOverlaid(map) {\n        /* global document */\n        const container = document.createElement('div');\n        Object.assign(container.style, {\n            position: 'absolute',\n            left: 0,\n            top: 0,\n            textAlign: 'initial',\n            pointerEvents: 'none'\n        });\n        this._container = container;\n        this._deck = new Deck({\n            ...this._props,\n            parent: container,\n            parameters: { ...getDefaultParameters(map, false), ...this._props.parameters },\n            views: this._props.views || getDefaultView(map),\n            viewState: getViewState(map)\n        });\n        map.on('resize', this._updateContainerSize);\n        map.on('render', this._updateViewState);\n        map.on('mousedown', this._handleMouseEvent);\n        map.on('dragstart', this._handleMouseEvent);\n        map.on('drag', this._handleMouseEvent);\n        map.on('dragend', this._handleMouseEvent);\n        map.on('mousemove', this._handleMouseEvent);\n        map.on('mouseout', this._handleMouseEvent);\n        map.on('click', this._handleMouseEvent);\n        map.on('dblclick', this._handleMouseEvent);\n        this._updateContainerSize();\n        return container;\n    }\n    _onAddInterleaved(map) {\n        // @ts-ignore non-public map property\n        const gl = map.painter.context.gl;\n        if (gl instanceof WebGLRenderingContext) {\n            log.warn('Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility')();\n        }\n        this._deck = getDeckInstance({\n            map,\n            gl,\n            deck: new Deck({\n                ...this._props,\n                gl,\n                parameters: { ...getDefaultParameters(map, true), ...this._props.parameters }\n            })\n        });\n        map.on('styledata', this._handleStyleChange);\n        this._resolveLayers(map, this._deck, [], this._props.layers);\n        return document.createElement('div');\n    }\n    _resolveLayers(map, deck, prevLayers, newLayers) {\n        if (this._renderLayersInGroups) {\n            resolveLayerGroups(map, prevLayers, newLayers);\n        }\n        else {\n            resolveLayers(map, deck, prevLayers, newLayers);\n        }\n    }\n    /** Called when the control is removed from a map */\n    onRemove() {\n        const map = this._map;\n        if (map) {\n            if (this._interleaved) {\n                this._onRemoveInterleaved(map);\n            }\n            else {\n                this._onRemoveOverlaid(map);\n            }\n        }\n        this._deck = undefined;\n        this._map = undefined;\n        this._container = undefined;\n    }\n    _onRemoveOverlaid(map) {\n        map.off('resize', this._updateContainerSize);\n        map.off('render', this._updateViewState);\n        map.off('mousedown', this._handleMouseEvent);\n        map.off('dragstart', this._handleMouseEvent);\n        map.off('drag', this._handleMouseEvent);\n        map.off('dragend', this._handleMouseEvent);\n        map.off('mousemove', this._handleMouseEvent);\n        map.off('mouseout', this._handleMouseEvent);\n        map.off('click', this._handleMouseEvent);\n        map.off('dblclick', this._handleMouseEvent);\n        this._deck?.finalize();\n    }\n    _onRemoveInterleaved(map) {\n        map.off('styledata', this._handleStyleChange);\n        this._resolveLayers(map, this._deck, this._props.layers, []);\n        removeDeckInstance(map);\n    }\n    getDefaultPosition() {\n        return 'top-left';\n    }\n    /** Forwards the Deck.pickObject method */\n    pickObject(params) {\n        assert(this._deck);\n        return this._deck.pickObject(params);\n    }\n    /** Forwards the Deck.pickMultipleObjects method */\n    pickMultipleObjects(params) {\n        assert(this._deck);\n        return this._deck.pickMultipleObjects(params);\n    }\n    /** Forwards the Deck.pickObjects method */\n    pickObjects(params) {\n        assert(this._deck);\n        return this._deck.pickObjects(params);\n    }\n    /** Remove from map and releases all resources */\n    finalize() {\n        if (this._map) {\n            this._map.removeControl(this);\n        }\n    }\n    /** If interleaved: true, returns base map's canvas, otherwise forwards the Deck.getCanvas method. */\n    getCanvas() {\n        if (!this._map) {\n            return null;\n        }\n        return this._interleaved ? this._map.getCanvas() : this._deck.getCanvas();\n    }\n}\n//# sourceMappingURL=mapbox-overlay.js.map"],"mappings":"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"}