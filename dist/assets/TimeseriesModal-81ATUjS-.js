import{a as e,n as t,o as n,t as r}from"./index-HXSG3NMo.js";function i(e){return function(){return e}}const a=Math.PI;a/2,2*a;var o=Math.PI,s=2*o,c=1e-6,l=s-c;function u(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function d(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return u;let n=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}var f=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._=``,this._append=e==null?u:d(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,a){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+a}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,i=+i,i<0)throw Error(`negative radius: ${i}`);let a=this._x1,s=this._y1,l=n-e,u=r-t,d=a-e,f=s-t,p=d*d+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(p>c)if(!(Math.abs(f*l-u*d)>c)||!i)this._append`L${this._x1=e},${this._y1=t}`;else{let m=n-a,h=r-s,g=l*l+u*u,_=m*m+h*h,v=Math.sqrt(g),y=Math.sqrt(p),b=i*Math.tan((o-Math.acos((g+p-_)/(2*v*y)))/2),x=b/y,S=b/v;Math.abs(x-1)>c&&this._append`L${e+x*d},${t+x*f}`,this._append`A${i},${i},0,0,${+(f*m>d*h)},${this._x1=e+S*l},${this._y1=t+S*u}`}}arc(e,t,n,r,i,a){if(e=+e,t=+t,n=+n,a=!!a,n<0)throw Error(`negative radius: ${n}`);let u=n*Math.cos(r),d=n*Math.sin(r),f=e+u,p=t+d,m=1^a,h=a?r-i:i-r;this._x1===null?this._append`M${f},${p}`:(Math.abs(this._x1-f)>c||Math.abs(this._y1-p)>c)&&this._append`L${f},${p}`,n&&(h<0&&(h=h%s+s),h>l?this._append`A${n},${n},0,1,${m},${e-u},${t-d}A${n},${n},0,1,${m},${this._x1=f},${this._y1=p}`:h>c&&this._append`A${n},${n},0,${+(h>=o)},${m},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}};function p(){return new f}p.prototype=f.prototype;function m(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{let e=Math.floor(n);if(!(e>=0))throw RangeError(`invalid digits: ${n}`);t=e}return e},()=>new f(t)}Array.prototype.slice;function h(e){return typeof e==`object`&&`length`in e?e:Array.from(e)}function g(e){this._context=e}g.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function _(e){return new g(e)}function v(e){return e[0]}function y(e){return e[1]}function b(e,t){var n=i(!0),r=null,a=_,o=null,s=m(c);e=typeof e==`function`?e:e===void 0?v:i(e),t=typeof t==`function`?t:t===void 0?y:i(t);function c(i){var c,l=(i=h(i)).length,u,d=!1,f;for(r??(o=a(f=s())),c=0;c<=l;++c)!(c<l&&n(u=i[c],c,i))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(u,c,i),+t(u,c,i));if(f)return o=null,f+``||null}return c.x=function(t){return arguments.length?(e=typeof t==`function`?t:i(+t),c):e},c.y=function(e){return arguments.length?(t=typeof e==`function`?e:i(+e),c):t},c.defined=function(e){return arguments.length?(n=typeof e==`function`?e:i(!!e),c):n},c.curve=function(e){return arguments.length?(a=e,r!=null&&(o=a(r)),c):a},c.context=function(e){return arguments.length?(e==null?r=o=null:o=a(r=e),c):r},c}function x(e,t,n){var r=null,a=i(!0),o=null,s=_,c=null,l=m(u);e=typeof e==`function`?e:e===void 0?v:i(+e),t=typeof t==`function`?t:i(t===void 0?0:+t),n=typeof n==`function`?n:n===void 0?y:i(+n);function u(i){var u,d,f,p=(i=h(i)).length,m,g=!1,_,v=Array(p),y=Array(p);for(o??(c=s(_=l())),u=0;u<=p;++u){if(!(u<p&&a(m=i[u],u,i))===g)if(g=!g)d=u,c.areaStart(),c.lineStart();else{for(c.lineEnd(),c.lineStart(),f=u-1;f>=d;--f)c.point(v[f],y[f]);c.lineEnd(),c.areaEnd()}g&&(v[u]=+e(m,u,i),y[u]=+t(m,u,i),c.point(r?+r(m,u,i):v[u],n?+n(m,u,i):y[u]))}if(_)return c=null,_+``||null}function d(){return b().defined(a).curve(s).context(o)}return u.x=function(t){return arguments.length?(e=typeof t==`function`?t:i(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e=typeof t==`function`?t:i(+t),u):e},u.x1=function(e){return arguments.length?(r=e==null?null:typeof e==`function`?e:i(+e),u):r},u.y=function(e){return arguments.length?(t=typeof e==`function`?e:i(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t=typeof e==`function`?e:i(+e),u):t},u.y1=function(e){return arguments.length?(n=e==null?null:typeof e==`function`?e:i(+e),u):n},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(n)},u.lineX1=function(){return d().x(r).y(t)},u.defined=function(e){return arguments.length?(a=typeof e==`function`?e:i(!!e),u):a},u.curve=function(e){return arguments.length?(s=e,o!=null&&(c=s(o)),u):s},u.context=function(e){return arguments.length?(e==null?o=c=null:c=s(o=e),u):o},u}function S(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function C(e,t){this._context=e,this._k=(1-t)/6}C.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:S(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:S(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}},(function e(t){function n(e){return new C(e,t)}return n.tension=function(t){return e(+t)},n})(0);function w(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>1e-12){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,c=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/c,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/c}if(e._l23_a>1e-12){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,u=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/u,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/u}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function T(e,t){this._context=e,this._alpha=t}T.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=(n*n+r*r)**+this._alpha)}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:w(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var E=(function e(t){function n(e){return t?new T(e,t):new C(e,0)}return n.alpha=function(t){return e(+t)},n})(.5),D=n(),O=e(),k={1980:`#22C55E`,1990:`#06B6D4`,2e3:`#3B82F6`,2010:`#A855F7`,2020:`#F472B6`},A=`#F59E0B`,j=.32,M=.6,N=2;function P({rows:e,currentWeek:t}){let n=(0,D.useId)(),r=(0,D.useRef)(null),i=I(r),a=(0,D.useMemo)(()=>F(e),[e]);if(!a)return null;let{decades:o,weeks:s,valuesByDecade:c,maxY:l}=a,u=Math.max(320,Math.floor(i.width||720)),d=Math.max(240,Math.floor(i.height||360)),f={top:18,right:16,bottom:78,left:56},p=Math.max(1,u-f.left-f.right),m=Math.max(1,d-f.top-f.bottom),h=s.length,g=e=>{let t=(V(e,h)-1)/Math.max(1,h-1);return f.left+t*p},_=e=>{let t=Math.max(0,e)/Math.max(1,l);return f.top+m-t*m},v=_(0),y=`rgba(255,255,255,0.92)`,b=`rgba(255,255,255,0.78)`,S=(0,D.useMemo)(()=>x().x((e,t)=>g(s[t])).y0(()=>v).y1(e=>_(e)).curve(E.alpha(.55)),[u,d,p,m,l,h,s]),C=(0,D.useMemo)(()=>o.map(e=>({decade:e,d:S(c.get(e)??s.map(()=>0))??``})),[o,c,s,S]),w=L(l,4),T=z(h),P=V(t,h),R=g(P),U=`Current week (W${P})`,W=f.top+10,G=R>f.left+p-160,K=G?R-10:R+10,q=G?`end`:`start`;return(0,O.jsxs)(`div`,{ref:r,className:`timeseries__svgWrap`,"aria-label":`Weekly sighting activity chart`,style:{width:`100%`,height:`100%`,display:`flex`,flexDirection:`column`},children:[(0,O.jsxs)(`svg`,{viewBox:`0 0 ${u} ${d}`,width:`100%`,height:`100%`,role:`img`,"aria-label":`Weekly sighting activity (overlay area chart by decade)`,style:{display:`block`,flex:`1 1 auto`},children:[(0,O.jsx)(`desc`,{id:`desc-${n}`,children:`Overlay area chart by decade across weekly activity.`}),(0,O.jsx)(`defs`,{children:(0,O.jsx)(`clipPath`,{id:`clip-${n}`,children:(0,O.jsx)(`rect`,{x:f.left,y:f.top,width:p,height:m})})}),w.map(e=>{let t=_(e);return(0,O.jsxs)(`g`,{children:[(0,O.jsx)(`line`,{x1:f.left,x2:f.left+p,y1:t,y2:t,stroke:`rgba(255,255,255,0.08)`,strokeWidth:1}),(0,O.jsx)(`text`,{x:f.left-10,y:t+4,textAnchor:`end`,fontSize:`12`,fill:b,children:B(e)})]},`ygrid-${e}`)}),T.map(e=>(0,O.jsx)(`text`,{x:g(e),y:f.top+m+18,textAnchor:`middle`,fontSize:`12`,fill:b,children:e},`xtick-${e}`)),(0,O.jsx)(`text`,{x:f.left+p/2,y:d-12,textAnchor:`middle`,fontSize:`12`,fill:y,children:`Week of Year`}),(0,O.jsx)(`text`,{x:16,y:f.top+m/2,transform:`rotate(-90 16 ${f.top+m/2})`,textAnchor:`middle`,fontSize:`12`,fill:y,children:`Total Active Grids`}),(0,O.jsx)(`g`,{clipPath:`url(#clip-${n})`,children:C.map(({decade:e,d:t})=>{let n=k[e]??`#A855F7`;return(0,O.jsxs)(`g`,{children:[(0,O.jsx)(`path`,{d:t,fill:H(n,j),stroke:`none`}),(0,O.jsx)(`path`,{d:t,fill:`none`,stroke:H(n,M),strokeWidth:N,vectorEffect:`non-scaling-stroke`,strokeLinejoin:`round`,strokeLinecap:`round`})]},e)})}),(0,O.jsx)(`line`,{x1:R,x2:R,y1:f.top,y2:f.top+m,stroke:A,strokeWidth:2,strokeDasharray:`4 4`}),(0,O.jsx)(`text`,{x:K,y:W,textAnchor:q,fontSize:`12`,fill:A,dominantBaseline:`hanging`,paintOrder:`stroke`,stroke:`rgba(10,15,30,0.65)`,strokeWidth:3,children:U})]}),(0,O.jsx)(`div`,{className:`timeseries__legend`,"aria-label":`Legend`,style:{display:`flex`,gap:18,justifyContent:`center`,alignItems:`center`,paddingTop:10,paddingBottom:6,fontSize:12,flex:`0 0 auto`,userSelect:`none`},children:o.map(e=>(0,O.jsxs)(`div`,{className:`timeseries__legendItem`,style:{display:`flex`,gap:8,alignItems:`center`},children:[(0,O.jsx)(`span`,{className:`timeseries__legendSwatch`,style:{width:12,height:12,borderRadius:4,background:k[e]??`#A855F7`,display:`inline-block`}}),(0,O.jsx)(`span`,{style:{color:y},children:`${e}s`})]},e))})]})}function F(e){if(!e.length)return null;let t=Array.from(new Set(e.map(e=>e.decade))).sort((e,t)=>e-t),n=Math.max(1,...e.map(e=>e.stat_week)),r=Array.from({length:n},(e,t)=>t+1),i=new Map;for(let t of e){let e=`${t.decade}-${t.stat_week}`;i.set(e,(i.get(e)??0)+(t.active_grids??0))}let a=new Map,o=1;for(let e of t){let t=r.map(t=>i.get(`${e}-${t}`)??0);a.set(e,t);for(let e of t)o=Math.max(o,e)}return{decades:t,weeks:r,valuesByDecade:a,maxY:o}}function I(e){let[t,n]=(0,D.useState)({width:0,height:0});return(0,D.useEffect)(()=>{let t=e.current;if(!t)return;let r=new ResizeObserver(e=>{let t=e[0]?.contentRect;t&&n({width:Math.floor(t.width),height:Math.floor(t.height)})});return r.observe(t),()=>r.disconnect()},[e]),t}function L(e,t){let n=R(e/Math.max(1,t)),r=[],i=Math.ceil(e/n)*n;for(let e=0;e<=i;e+=n)r.push(e);return r}function R(e){if(e<=0)return 1;let t=10**Math.floor(Math.log10(e)),n=e/t,r=1;return r=n<1.5?1:n<3?2:n<7?5:10,r*t}function z(e){return e>=53?[1,13,26,39,53]:[1,13,26,39,52].filter(t=>t<=e)}function B(e){return e>=1e3?`${Math.round(e/100)/10}k`:e>=100?`${Math.round(e)}`:e.toFixed(0)}function V(e,t){return Number.isFinite(e)?Math.min(Math.max(1,Math.round(e)),t):1}function H(e,t){let n=e.replace(`#`,``);return n.length===6?`rgba(${parseInt(n.slice(0,2),16)},${parseInt(n.slice(2,4),16)},${parseInt(n.slice(4,6),16)},${t})`:`rgba(0,0,0,${t})`}function U({open:e,onClose:n,darkMode:i,currentWeek:a,forecastPeriodLabel:o,forecastPath:s,resolution:c,ecotype:l=`SRKW`}){let u=(0,D.useRef)(new Map),[d,f]=(0,D.useState)(null),[p,m]=(0,D.useState)(null),[h,g]=(0,D.useState)(!1),[_,v]=(0,D.useState)(null);(0,D.useEffect)(()=>{if(!e)return;f(null),g(!0),m(null);let t=`${l}-${c}`,n=u.current.get(t);if(n){f(n),g(!1);return}(async()=>{try{let e=[(e=>{let t=e.startsWith(`/`)?e:`/${e}`;return`${window.location.origin}${t}`})(`/data/activity/activity_by_decade_week_${l}_${c}.json`)],n=null;for(let t of e){let e=await fetch(t,{cache:`force-cache`});if(!e.ok)continue;let r=await e.text();if(!r.trim().startsWith(`<`)){n=JSON.parse(r);break}}if(!n)throw Error(`Data not available`);u.current.set(t,n),f(n),m(null)}catch(e){console.warn(`[Timeseries] failed to load activity data`,e),m(e instanceof Error?e.message:String(e))}finally{g(!1)}})()},[e,l,c]),(0,D.useEffect)(()=>{e&&(v(null),(async()=>{try{let e=s??t[c],n=new URL(e,window.location.origin).toString(),i=await fetch(n,{cache:`force-cache`});if(!i.ok)return;let a=await i.text();if(a.trim().startsWith(`<`))return;let o=JSON.parse(a),l=o.stat_week??o.statWeek;if(typeof l==`number`&&Number.isFinite(l)){v(l);return}o.target_start&&v(r(new Date(o.target_start)))}catch{}})())},[e,c]);let y=_??a;return e?(0,O.jsx)(`div`,{className:`overlay overlay--blur`,onClick:n,role:`presentation`,children:(0,O.jsxs)(`section`,{className:`modal modal--timeseries`,onClick:e=>e.stopPropagation(),"aria-label":`Weekly Sighting Activity - Average # of Active Grids by Week`,children:[(0,O.jsxs)(`div`,{className:`modal__header`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`div`,{className:`modal__title`,children:`Weekly Sighting Activity (Average Weekly # Each Decade)`}),(0,O.jsx)(`div`,{className:`modal__subtitle`,children:`Avg by decade`})]}),(0,O.jsx)(`button`,{className:`iconBtn iconBtn--ghost`,onClick:n,"aria-label":`Close`,children:(0,O.jsx)(`span`,{className:`material-symbols-rounded`,children:`close`})})]}),(0,O.jsxs)(`div`,{className:`modal__body`,children:[(0,O.jsxs)(`div`,{className:`timeseries__chart`,children:[(0,O.jsx)(`div`,{className:`timeseries__plot`,children:d&&(0,O.jsx)(P,{rows:d.rows,currentWeek:y,darkMode:i})}),(!d||p||h)&&(0,O.jsxs)(`div`,{className:`timeseries__loading`,children:[h&&`Loading chartâ€¦`,!h&&p&&p,!h&&!p&&!d&&`Data not available`]})]}),(0,O.jsxs)(`div`,{className:`timeseries__meta`,children:[(0,O.jsxs)(`span`,{children:[`Current week: `,y]}),(0,O.jsxs)(`span`,{children:[`Forecast period: `,o]})]})]})]})}):null}export{U as TimeseriesModal};